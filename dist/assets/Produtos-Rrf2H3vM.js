import{u as R,l as Q,m as $,V as L,a as A,b as T,f as M,d as p,c as G,e as O,k as K}from"./VList-EL7smbZR.js";import{a as U,b as H}from"./VTextField-DW8nCNV5.js";import{V as J}from"./VAlert-GDjScSAF.js";import{V as W}from"./VDataTable-BwrgDJdF.js";import{u as X,m as Y}from"./tag-BQQzLX6E.js";import{h as Z,p as ee,i as te,j as ae,k as F,l as oe,m as se,b as l,n as re,F as le,q as ne,s as ie,v as de,x as h,y as ce,c as S,o as _,w as o,a as s,d as y,e as ue,g as E,t as f,_ as me}from"./index-Cgq_6uxJ.js";import{V as pe}from"./VChip-BwqJumVp.js";import{b as q}from"./route-block-B_A1xBdJ.js";import"./VSelect-DdUCyK7X.js";import"./VMenu-C4chORbR.js";import"./filter-CQcYvJU3.js";function fe(){return"http://localhost:3001"}const ge={actions:"button@2",article:"heading, paragraph",avatar:"avatar",button:"button",card:"image, heading","card-avatar":"image, list-item-avatar",chip:"chip","date-picker":"list-item, heading, divider, date-picker-options, date-picker-days, actions","date-picker-options":"text, avatar@2","date-picker-days":"avatar@28",divider:"divider",heading:"heading",image:"image","list-item":"text","list-item-avatar":"avatar, text","list-item-two-line":"sentences","list-item-avatar-two-line":"avatar, sentences","list-item-three-line":"paragraph","list-item-avatar-three-line":"avatar, paragraph",ossein:"ossein",paragraph:"text@3",sentences:"text@2",subtitle:"text",table:"table-heading, table-thead, table-tbody, table-tfoot","table-heading":"chip, text","table-thead":"heading@6","table-tbody":"table-row-divider@6","table-row-divider":"table-row, divider","table-row":"text@6","table-tfoot":"text@2, avatar@2",text:"text"};function ve(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return l("div",{class:ie(["v-skeleton-loader__bone",`v-skeleton-loader__${e}`])},[n])}function z(e){const[n,i]=e.split("@");return Array.from({length:i}).map(()=>b(n))}function b(e){let n=[];if(!e)return n;const i=ge[e];if(e!==i){if(e.includes(","))return N(e);if(e.includes("@"))return z(e);i.includes(",")?n=N(i):i.includes("@")?n=z(i):i&&n.push(b(i))}return[ve(e,n)]}function N(e){return e.replace(/\s/g,"").split(",").map(b)}const he=ee({boilerplate:Boolean,color:String,loading:Boolean,loadingText:{type:String,default:"$vuetify.loading"},type:{type:[String,Array],default:"ossein"},...Y(),...$(),...ne()},"VSkeletonLoader"),_e=Z()({name:"VSkeletonLoader",inheritAttrs:!1,props:he(),setup(e,n){let{attrs:i,slots:d}=n;const{backgroundColorClasses:c,backgroundColorStyles:x}=R(()=>e.color),{dimensionStyles:g}=X(e),{elevationClasses:k}=Q(e),{themeClasses:w}=te(e),{t:V}=ae(),C=F(()=>b(oe(e.type).join(",")));return se(()=>{const r=!d.default||e.loading,t=e.boilerplate||!r?{}:{ariaLive:"polite",ariaLabel:V(e.loadingText),role:"alert"};return l(le,null,[r?l("div",re({class:["v-skeleton-loader",{"v-skeleton-loader--boilerplate":e.boilerplate},w.value,c.value,k.value],style:[x.value,g.value]},t,i),[C.value]):d.default?.()])}),{}}}),ye={class:"d-flex align-center"},be={key:0,class:"text-center py-8"},xe={class:"d-flex align-center py-2"},ke={class:"font-weight-medium"},we={class:"d-flex align-center"},Ve={class:"font-weight-medium"},Ce={class:"d-flex align-center"},Pe={},j=de({...Pe,__name:"Produtos",setup(e){const n=h([]),i=h([]),d=h(!1),c=h(null),x=[{title:"Produto",key:"nome",sortable:!0},{title:"Estoque Total",key:"totalQuantity",sortable:!0},{title:"Validade Próxima",key:"nearestExpiry",sortable:!1},{title:"Status",key:"status",sortable:!0}],g=fe();async function k(){d.value=!0,c.value=null;try{const[r,t]=await Promise.all([fetch(`${g}/produtos`),fetch(`${g}/produto_lotes`)]);if(!r.ok)throw new Error("Falha ao carregar produtos");if(!t.ok)throw new Error("Falha ao carregar lotes de produtos");const a=await r.json(),u=await t.json();n.value=Array.isArray(a[0])?a[0]:a,i.value=Array.isArray(u[0])?u[0]:u}catch(r){c.value=r.message||"Ocorreu um erro desconhecido"}finally{d.value=!1}}const w=F(()=>{const r=new Map;for(const t of i.value){const a=r.get(t.id_produto)||[];a.push(t),r.set(t.id_produto,a)}return n.value.map(t=>{const a=r.get(t.id)||[],u=a.reduce((m,B)=>m+B.quantidade,0),v=a.filter(m=>new Date(m.data_validade)>new Date).slice().sort((m,B)=>new Date(m.data_validade).getTime()-new Date(B.data_validade).getTime())[0],I=v?new Date(v.data_validade).toLocaleDateString("pt-BR"):"N/A";let P="OK";const D=new Date;return D.setDate(D.getDate()+30),u<t.estoque_minimo?P="Estoque Baixo":v&&new Date(v.data_validade)<D&&(P="Vencimento Próximo"),{id:t.id,nome:t.nome,totalQuantity:u,nearestExpiry:I,status:P}})});ce(()=>{k()});function V(r){switch(r){case"Estoque Baixo":return"warning";case"Vencimento Próximo":return"error";default:return"success"}}function C(r){switch(r){case"Estoque Baixo":return"mdi-alert-circle";case"Vencimento Próximo":return"mdi-clock-alert";default:return"mdi-check-circle"}}return(r,t)=>(_(),S(K,{class:"pa-6",fluid:""},{default:o(()=>[s(L,{class:"mb-6"},{default:o(()=>[s(A,{cols:"12"},{default:o(()=>[s(T,{class:"rounded-lg",elevation:"0"},{default:o(()=>[s(M,{class:"d-flex align-center justify-space-between pa-6"},{default:o(()=>[l("div",ye,[s(p,{class:"mr-3",color:"primary",icon:"mdi-package-variant",size:"32"}),t[0]||(t[0]=l("div",null,[l("h1",{class:"text-h4 font-weight-bold mb-1"}," Gerenciamento de Produtos "),l("p",{class:"text-subtitle-2 text-medium-emphasis mb-0"}," Gerencie todos os produtos e estoque do sistema ")],-1))]),l("div",null,[s(U,{color:"primary","prepend-icon":"mdi-package-variant-plus",variant:"elevated",to:{name:"CadastroProdutos"}},{default:o(()=>[...t[1]||(t[1]=[y(" Cadastrar Produto ",-1)])]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1}),s(L,null,{default:o(()=>[s(A,{cols:"12"},{default:o(()=>[s(T,{class:"rounded-lg",elevation:"2"},{default:o(()=>[s(G,{class:"pa-6"},{default:o(()=>[d.value?(_(),ue("div",be,[s(H,{color:"primary",indeterminate:"",size:"64"}),t[2]||(t[2]=l("p",{class:"text-subtitle-1 mt-4"}," Carregando produtos... ",-1))])):E("",!0),c.value?(_(),S(J,{key:1,class:"mb-4",closable:"",type:"error",variant:"tonal"},{default:o(()=>[y(f(c.value),1)]),_:1})):E("",!0),!d.value&&!c.value?(_(),S(W,{key:2,class:"elevation-1 rounded-lg",headers:x,items:w.value,"items-per-page-text":"Produtos por página",loading:d.value,"loading-text":"Carregando produtos...","no-data-text":"Nenhum produto encontrado"},{"item.nome":o(({item:a})=>[l("div",xe,[s(O,{class:"mr-3",color:"primary",size:"40"},{default:o(()=>[s(p,null,{default:o(()=>[...t[3]||(t[3]=[y("mdi-package-variant",-1)])]),_:1})]),_:1}),l("span",ke,f(a.nome),1)])]),"item.totalQuantity":o(({item:a})=>[l("div",we,[s(p,{class:"mr-2 text-medium-emphasis",icon:"mdi-package-variant-closed",size:"small"}),l("span",Ve,f(a.totalQuantity),1)])]),"item.nearestExpiry":o(({item:a})=>[l("div",Ce,[s(p,{class:"mr-2 text-medium-emphasis",icon:"mdi-calendar",size:"small"}),l("span",null,f(a.nearestExpiry),1)])]),"item.status":o(({item:a})=>[s(pe,{color:V(a.status),size:"small",variant:"flat"},{default:o(()=>[s(p,{icon:C(a.status),size:"small",start:""},null,8,["icon"]),y(" "+f(a.status),1)]),_:2},1032,["color"])]),loading:o(()=>[s(_e,{type:"table-row@5"})]),_:2},1032,["items","loading"])):E("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}});typeof q=="function"&&q(j);const Re=me(j,[["__scopeId","data-v-5a081ae8"]]);export{Re as default};
