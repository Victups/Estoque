import{U as n}from"./index-2CK1TBd1.js";const s=(a,o=0)=>{if(a==null)return o;const i=typeof a=="number"?a:Number(a);return Number.isNaN(i)?o:i},r=a=>({id:a.id,id_produto:a.produto?.id??0,codigo_lote:a.codigoLote??a.codigo_lote??"",data_validade:a.dataValidade??a.data_validade??null,quantidade:s(a.quantidade,0),data_entrada:a.dataEntrada??a.data_entrada??new Date().toISOString(),responsavel_cadastro:a.responsavelCadastro?.id??a.responsavel_cadastro??0,custo_unitario:a.custoUnitario!==void 0?s(a.custoUnitario,0):a.custo_unitario!==void 0?s(a.custo_unitario,0):void 0,usuario_log_id:a.usuarioLogId??a.usuario_log_id??null,id_localizacao:a.localizacao?.id??a.id_localizacao??null,ativo:a.ativo??!0}),_=a=>{const o=r(a),i=a.localizacao?.corredor??"",t=a.localizacao?.prateleira??"",e=a.localizacao?.secao??"",d=[i,t,e].filter(Boolean).join(" - ")||void 0;return{...o,produto_nome:a.produto?.nome,produto_codigo:a.produto?.codigo,localizacao_nome:d}},p=a=>{const o=r(a),i=a.localizacao?.deposito?.endereco,t=i?.municipio,e=t?.uf,d=[i?.logradouro,i?.numero,i?.complemento].filter(Boolean).join(", "),c=[a.localizacao?.deposito?.nome,a.localizacao?.corredor,a.localizacao?.prateleira,a.localizacao?.secao].filter(Boolean).join(" - ");return{...o,produto_nome:a.produto?.nome,produto_codigo:a.produto?.codigo,localizacao_corredor:a.localizacao?.corredor??void 0,localizacao_prateleira:a.localizacao?.prateleira??void 0,localizacao_secao:a.localizacao?.secao??void 0,deposito_nome:a.localizacao?.deposito?.nome,endereco_completo:d||void 0,endereco_cep:i?.cep,municipio_nome:t?.nome,municipio_bairro:t?.bairro??void 0,uf_sigla:e?.sigla,uf_nome:e?.nome,uf_id:e?.id,localizacao_completa:c||void 0}},l=a=>{const o=Object.entries(a).filter(([,i])=>i!=null);return Object.fromEntries(o)};class m{endpoint="/lotes";async fetchAll(){const{data:o}=await n.get(this.endpoint);return o}async getAll(){return(await this.fetchAll()).map(r)}async getAllEnriched(){return(await this.fetchAll()).map(_)}async getAllComplete(o){return(await this.fetchAll()).filter(t=>o==null?!0:t.localizacao?.deposito?.endereco?.municipio?.uf?.id===o).map(p)}async getById(o){const{data:i}=await n.get(`${this.endpoint}/${o}`);return r(i)}async getByProduct(o){return(await this.getAll()).filter(t=>t.id_produto===o)}async getAvailableByProductFIFO(o){return(await this.getByProduct(o)).filter(e=>e.quantidade>0).sort((e,d)=>{const c=e.data_validade?new Date(e.data_validade).getTime():Number.MAX_SAFE_INTEGER,u=d.data_validade?new Date(d.data_validade).getTime():Number.MAX_SAFE_INTEGER;return c-u})}async getByLocation(o){return(await this.getAll()).filter(t=>t.id_localizacao===o)}async getExpiringSoon(o=30){const i=await this.getAll(),t=new Date,e=new Date;return e.setDate(t.getDate()+o),i.filter(d=>{if(!d.data_validade)return!1;const c=new Date(d.data_validade);return c>=t&&c<=e})}async create(o){const i=l({id_produto:o.id_produto,codigo_lote:o.codigo_lote?.trim()||void 0,data_validade:o.data_validade??void 0,quantidade:o.quantidade,data_entrada:o.data_entrada,responsavel_cadastro:o.responsavel_cadastro,custo_unitario:o.custo_unitario,usuario_log_id:o.usuario_log_id??void 0,id_localizacao:o.id_localizacao??void 0,ativo:o.ativo}),{data:t}=await n.post(this.endpoint,i);return r(t)}async update(o,i){const t=l({id_produto:i.id_produto,codigo_lote:i.codigo_lote?.trim(),data_validade:i.data_validade??void 0,quantidade:i.quantidade,data_entrada:i.data_entrada,responsavel_cadastro:i.responsavel_cadastro,custo_unitario:i.custo_unitario,usuario_log_id:i.usuario_log_id,id_localizacao:i.id_localizacao,ativo:i.ativo}),{data:e}=await n.patch(`${this.endpoint}/${o}`,t);return r(e)}async delete(o){await n.delete(`${this.endpoint}/${o}`)}}const g=new m;export{g as L};
