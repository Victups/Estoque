import{b as k}from"./route-block-B_A1xBdJ.js";import{i as A,p as E,j as L,k as T,l as q,m as z,n as I,b as i,q as N,F,s as j,v as R,_ as Q,c as b,o as h,w as s,a as o,e as v,f as G,h as x,t as g}from"./index-Dh7kI4jI.js";import{u as M,g as O,m as K,V as w,a as P,b as V,h as U,d as f,c as H,e as J,f as W}from"./VCard-Cmc6vJ8q.js";import{a as X,b as Y}from"./VTextField-BR1_iDts.js";import{V as Z}from"./VAlert-BMtlPOoC.js";import{V as $}from"./VDataTable-CkDrtwBk.js";import{u as ee,m as te}from"./tag-CE7kSe09.js";import{V as ae}from"./VChip-DgJE4qLc.js";import"./ssrBoot-CK06tIrr.js";import"./VSelect-DK1SXm7i.js";import"./VMenu-x2Orytf9.js";import"./filter-B-yaYJPB.js";function se(){return"http://localhost:3001"}const oe={actions:"button@2",article:"heading, paragraph",avatar:"avatar",button:"button",card:"image, heading","card-avatar":"image, list-item-avatar",chip:"chip","date-picker":"list-item, heading, divider, date-picker-options, date-picker-days, actions","date-picker-options":"text, avatar@2","date-picker-days":"avatar@28",divider:"divider",heading:"heading",image:"image","list-item":"text","list-item-avatar":"avatar, text","list-item-two-line":"sentences","list-item-avatar-two-line":"avatar, sentences","list-item-three-line":"paragraph","list-item-avatar-three-line":"avatar, paragraph",ossein:"ossein",paragraph:"text@3",sentences:"text@2",subtitle:"text",table:"table-heading, table-thead, table-tbody, table-tfoot","table-heading":"chip, text","table-thead":"heading@6","table-tbody":"table-row-divider@6","table-row-divider":"table-row, divider","table-row":"text@6","table-tfoot":"text@2, avatar@2",text:"text"};function re(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return i("div",{class:R(["v-skeleton-loader__bone",`v-skeleton-loader__${e}`])},[t])}function C(e){const[t,a]=e.split("@");return Array.from({length:a}).map(()=>y(t))}function y(e){let t=[];if(!e)return t;const a=oe[e];if(e!==a){if(e.includes(","))return S(e);if(e.includes("@"))return C(e);a.includes(",")?t=S(a):a.includes("@")?t=C(a):a&&t.push(y(a))}return[re(e,t)]}function S(e){return e.replace(/\s/g,"").split(",").map(y)}const ie=E({boilerplate:Boolean,color:String,loading:Boolean,loadingText:{type:String,default:"$vuetify.loading"},type:{type:[String,Array],default:"ossein"},...te(),...K(),...j()},"VSkeletonLoader"),le=A()({name:"VSkeletonLoader",inheritAttrs:!1,props:ie(),setup(e,t){let{attrs:a,slots:l}=t;const{backgroundColorClasses:n,backgroundColorStyles:c}=M(()=>e.color),{dimensionStyles:r}=ee(e),{elevationClasses:_}=O(e),{themeClasses:m}=L(e),{t:p}=T(),d=q(()=>y(z(e.type).join(",")));return I(()=>{const u=!l.default||e.loading,D=e.boilerplate||!u?{}:{ariaLive:"polite",ariaLabel:p(e.loadingText),role:"alert"};return i(F,null,[u?i("div",N({class:["v-skeleton-loader",{"v-skeleton-loader--boilerplate":e.boilerplate},m.value,n.value,_.value],style:[c.value,r.value]},D,a),[d.value]):l.default?.()])}),{}}}),B={name:"ProdutosPage",data(){return{allProducts:[],allProductLots:[],loading:!1,error:null,headers:[{title:"Produto",key:"nome",sortable:!0},{title:"Estoque Total",key:"totalQuantity",sortable:!0},{title:"Validade Próxima",key:"nearestExpiry",sortable:!1},{title:"Status",key:"status",sortable:!0}],API_BASE:se()}},computed:{displayProducts(){const e=new Map;for(const t of this.allProductLots){const a=e.get(t.id_produto)||[];a.push(t),e.set(t.id_produto,a)}return this.allProducts.map(t=>{const a=e.get(t.id)||[],l=a.reduce((d,u)=>d+u.quantidade,0),r=a.filter(d=>new Date(d.data_validade)>new Date).slice().sort((d,u)=>new Date(d.data_validade).getTime()-new Date(u.data_validade).getTime())[0],_=r?new Date(r.data_validade).toLocaleDateString("pt-BR"):"N/A";let m="OK";const p=new Date;return p.setDate(p.getDate()+30),l<t.estoque_minimo?m="Estoque Baixo":r&&new Date(r.data_validade)<p&&(m="Vencimento Próximo"),{id:t.id,nome:t.nome,totalQuantity:l,nearestExpiry:_,status:m}})}},mounted(){this.fetchData()},methods:{async fetchData(){this.loading=!0,this.error=null;try{const[e,t]=await Promise.all([fetch(`${this.API_BASE}/produtos`),fetch(`${this.API_BASE}/produto_lotes`)]);if(!e.ok)throw new Error("Falha ao carregar produtos");if(!t.ok)throw new Error("Falha ao carregar lotes de produtos");const a=await e.json(),l=await t.json();this.allProducts=Array.isArray(a[0])?a[0]:a,this.allProductLots=Array.isArray(l[0])?l[0]:l}catch(e){this.error=e.message||"Ocorreu um erro desconhecido"}finally{this.loading=!1}},getStatusColor(e){switch(e){case"Estoque Baixo":return"warning";case"Vencimento Próximo":return"error";default:return"success"}},getStatusIcon(e){switch(e){case"Estoque Baixo":return"mdi-alert-circle";case"Vencimento Próximo":return"mdi-clock-alert";default:return"mdi-check-circle"}}}},ne={class:"d-flex align-center"},de={key:0,class:"text-center py-8"},ce={class:"d-flex align-center py-2"},ue={class:"font-weight-medium"},me={class:"d-flex align-center"},pe={class:"font-weight-medium"},ge={class:"d-flex align-center"};function fe(e,t,a,l,n,c){return h(),b(W,{class:"pa-6",fluid:""},{default:s(()=>[o(w,{class:"mb-6"},{default:s(()=>[o(P,{cols:"12"},{default:s(()=>[o(V,{class:"rounded-lg",elevation:"0"},{default:s(()=>[o(U,{class:"d-flex align-center justify-space-between pa-6"},{default:s(()=>[i("div",ne,[o(f,{class:"mr-3",color:"primary",icon:"mdi-package-variant",size:"32"}),t[0]||(t[0]=i("div",null,[i("h1",{class:"text-h4 font-weight-bold mb-1"}," Gerenciamento de Produtos "),i("p",{class:"text-subtitle-2 text-medium-emphasis mb-0"}," Gerencie todos os produtos e estoque do sistema ")],-1))]),i("div",null,[o(X,{color:"primary","prepend-icon":"mdi-package-variant-plus",variant:"elevated",to:{name:"CadastroProdutos"}},{default:s(()=>[...t[1]||(t[1]=[v(" Cadastrar Produto ",-1)])]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1}),o(w,null,{default:s(()=>[o(P,{cols:"12"},{default:s(()=>[o(V,{class:"rounded-lg",elevation:"2"},{default:s(()=>[o(H,{class:"pa-6"},{default:s(()=>[n.loading?(h(),G("div",de,[o(Y,{color:"primary",indeterminate:"",size:"64"}),t[2]||(t[2]=i("p",{class:"text-subtitle-1 mt-4"}," Carregando produtos... ",-1))])):x("",!0),n.error?(h(),b(Z,{key:1,class:"mb-4",closable:"",type:"error",variant:"tonal"},{default:s(()=>[v(g(n.error),1)]),_:1})):x("",!0),!n.loading&&!n.error?(h(),b($,{key:2,class:"elevation-1 rounded-lg",headers:n.headers,items:c.displayProducts,"items-per-page-text":"Produtos por página",loading:n.loading,"loading-text":"Carregando produtos...","no-data-text":"Nenhum produto encontrado"},{"item.nome":s(({item:r})=>[i("div",ce,[o(J,{class:"mr-3",color:"primary",size:"40"},{default:s(()=>[o(f,null,{default:s(()=>[...t[3]||(t[3]=[v("mdi-package-variant",-1)])]),_:1})]),_:1}),i("span",ue,g(r.nome),1)])]),"item.totalQuantity":s(({item:r})=>[i("div",me,[o(f,{class:"mr-2 text-medium-emphasis",icon:"mdi-package-variant-closed",size:"small"}),i("span",pe,g(r.totalQuantity),1)])]),"item.nearestExpiry":s(({item:r})=>[i("div",ge,[o(f,{class:"mr-2 text-medium-emphasis",icon:"mdi-calendar",size:"small"}),i("span",null,g(r.nearestExpiry),1)])]),"item.status":s(({item:r})=>[o(ae,{color:c.getStatusColor(r.status),size:"small",variant:"flat"},{default:s(()=>[o(f,{icon:c.getStatusIcon(r.status),size:"small",start:""},null,8,["icon"]),v(" "+g(r.status),1)]),_:2},1032,["color"])]),loading:s(()=>[o(le,{type:"table-row@5"})]),_:2},1032,["headers","items","loading"])):x("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}typeof k=="function"&&k(B);const Be=Q(B,[["render",fe],["__scopeId","data-v-9d1fe8cc"]]);export{Be as default};
