import{v as b,s as h}from"./validation-DSMrrFCg.js";import"./uf.service-Bn8JpA_W.js";import{C as S,B as q,U as C,L as U,P as y}from"./product.service-DE7QUhp7.js";import{L as k,V as u}from"./VAutocomplete-N6I3sgHX.js";import{S as I}from"./supplier.service-D8RTGJYr.js";import{u as z,_ as F,e as P,o as _,a as r,w as t,d as n,f as M,c as w,g as N,t as v,b as B}from"./index-Cgq_6uxJ.js";import{b as V}from"./route-block-B_A1xBdJ.js";import{V as f,a as d,b as O,f as R,d as p,c as x,k as L}from"./VList-EL7smbZR.js";import{V as E}from"./VForm-DePCEDBA.js";import{V as s,a as g}from"./VTextField-DW8nCNV5.js";import{V as T}from"./VCheckbox-GlW-IOaa.js";import{V as A}from"./VSnackbar-DySBK_uh.js";import"./VSelect-DdUCyK7X.js";import"./VMenu-C4chORbR.js";import"./tag-BQQzLX6E.js";import"./VChip-BwqJumVp.js";import"./filter-CQcYvJU3.js";const D={name:"CadastroProdutosPage",mixins:[b,h],setup(){return{authStore:z()}},data(){return{validForm:!1,saving:!1,formRef:null,categorias:[],marcas:[],unidadesMedida:[],fornecedores:[],localizacoes:[],formData:{nome:"",descricao:"",id_categoria:null,id_marca:null,id_unidade_medida:null,estoque_minimo:0,is_perecivel:!1,data_validade:null,custo_unitario:0,preco_venda:0,quantidade:0,id_localizacao:null,id_fornecedor:null},custoUnitarioInput:"",precoVendaInput:""}},computed:{rules(){return{nome:[e=>!!e||"Nome é obrigatório",e=>e.length>=3||"Nome deve ter pelo menos 3 caracteres"],descricao:[e=>!!e||"Descrição é obrigatória",e=>e.length>=10||"Descrição deve ter pelo menos 10 caracteres"],id_categoria:[e=>!!e||"Categoria é obrigatória"],id_marca:[e=>!!e||"Marca é obrigatória"],id_unidade_medida:[e=>!!e||"Unidade de medida é obrigatória"],estoque_minimo:[e=>e>=0||"Estoque mínimo deve ser maior ou igual a 0"],data_validade:[e=>this.formData.is_perecivel?!!e||"Data de validade é obrigatória para produtos perecíveis":!0],custo_unitario:[e=>e>0||"Custo unitário deve ser maior que 0"],preco_venda:[e=>e>0||"Preço de venda deve ser maior que 0"],quantidade:[e=>e>0||"Quantidade deve ser maior que 0"],id_localizacao:[e=>!!e||"Localização é obrigatória"],id_fornecedor:[e=>!!e||"Fornecedor é obrigatório"]}},categoriaOptions(){return this.categorias.map(e=>({title:e.nome,value:e.id}))},marcaOptions(){return this.marcas.map(e=>({title:e.nome,value:e.id}))},unidadeMedidaOptions(){return this.unidadesMedida.map(e=>({title:`${e.descricao} (${e.abreviacao})`,value:e.id}))},fornecedorOptions(){return this.fornecedores.map(e=>({title:e.nome,value:e.id}))},localizacaoOptions(){return this.localizacoes.map(e=>({title:`${e.deposito_nome} - ${e.corredor||""} ${e.prateleira||""} ${e.secao||""}`.trim(),value:e.id}))}},methods:{formatBRLFromCents(e){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e/100)},toCents(e){const a=e.replace(/[^\d]/g,"");return parseInt(a)||0},toNumber(e){const a=e.replace(/[^\d,]/g,"").replace(",",".");return parseFloat(a)||0},formatNumber(e){return new Intl.NumberFormat("pt-BR").format(e)},onCustoUnitarioInput(e){const a=this.toCents(e);this.custoUnitarioInput=this.formatBRLFromCents(a),this.formData.custo_unitario=a},onPrecoVendaInput(e){const a=this.toCents(e);this.precoVendaInput=this.formatBRLFromCents(a),this.formData.preco_venda=a},limparFormulario(){this.formData={nome:"",descricao:"",id_categoria:null,id_marca:null,id_unidade_medida:null,estoque_minimo:0,is_perecivel:!1,data_validade:null,custo_unitario:0,preco_venda:0,quantidade:0,id_localizacao:null,id_fornecedor:null},this.custoUnitarioInput="",this.precoVendaInput="",this.formRef&&this.formRef.reset()},async salvarProduto(){if(this.validForm){this.saving=!0;try{const e={nome:this.formData.nome,descricao:this.formData.descricao,codigo:"",id_categoria:this.formData.id_categoria,id_marca:this.formData.id_marca,id_unidade_medida:this.formData.id_unidade_medida,estoque_minimo:this.formData.estoque_minimo,is_perecivel:this.formData.is_perecivel,responsavel_cadastro:(this.authStore.userName,1),usuario_log_id:(this.authStore.userName,1),data_cadastro:new Date().toISOString()},a=await y.create(e),m=this.formData.data_validade||new Date().toISOString().split("T")[0],c=new Date().toISOString().split("T")[0],o={id_produto:a.id,codigo_lote:"",data_validade:m,quantidade:this.formData.quantidade,data_entrada:c,custo_unitario:this.formData.custo_unitario,preco_venda:this.formData.preco_venda,responsavel_cadastro:(this.authStore.userName,1),usuario_log_id:(this.authStore.userName,1),id_localizacao:this.formData.id_localizacao};await k.create(o),this.showSuccess("Produto cadastrado com sucesso!"),this.limparFormulario()}catch(e){console.error("Erro ao salvar produto:",e),this.showError("Erro ao cadastrar produto")}finally{this.saving=!1}}},async loadData(){try{const[e,a,m,c,o]=await Promise.all([S.getAll(),q.getAll(),C.getAll(),I.getAll(),U.getAllComplete()]);this.categorias=e,this.marcas=a,this.unidadesMedida=m,this.fornecedores=c,this.localizacoes=o}catch(e){console.error("Erro ao carregar dados:",e),this.showError("Erro ao carregar dados")}}},mounted(){this.loadData()}},Y={class:"cadastro-produtos-page"},Q={class:"d-flex align-center"};function j(e,a,m,c,o,l){return _(),P("div",Y,[r(L,{fluid:""},{default:t(()=>[r(f,null,{default:t(()=>[r(d,{cols:"12"},{default:t(()=>[r(O,{class:"elevation-8"},{default:t(()=>[r(R,{class:"text-h4 text-center py-6"},{default:t(()=>[r(p,{class:"mr-3",color:"primary",size:"large"},{default:t(()=>[...a[15]||(a[15]=[n("mdi-package-variant-plus",-1)])]),_:1}),a[16]||(a[16]=n(" Cadastro de Produtos ",-1))]),_:1}),r(x,null,{default:t(()=>[r(E,{ref:"formRef",modelValue:o.validForm,"onUpdate:modelValue":a[13]||(a[13]=i=>o.validForm=i),onSubmit:M(l.salvarProduto,["prevent"])},{default:t(()=>[r(f,null,{default:t(()=>[r(d,{cols:"12",md:"6"},{default:t(()=>[r(s,{modelValue:o.formData.nome,"onUpdate:modelValue":a[0]||(a[0]=i=>o.formData.nome=i),rules:l.rules.nome,label:"Nome do Produto",placeholder:"Digite o nome do produto","prepend-inner-icon":"mdi-package-variant",variant:"outlined",required:""},null,8,["modelValue","rules"])]),_:1}),r(d,{cols:"12",md:"6"},{default:t(()=>[r(s,{modelValue:o.formData.descricao,"onUpdate:modelValue":a[1]||(a[1]=i=>o.formData.descricao=i),rules:l.rules.descricao,label:"Descrição",placeholder:"Descreva o produto","prepend-inner-icon":"mdi-text",variant:"outlined",required:""},null,8,["modelValue","rules"])]),_:1}),r(d,{cols:"12",md:"6"},{default:t(()=>[r(u,{modelValue:o.formData.id_categoria,"onUpdate:modelValue":a[2]||(a[2]=i=>o.formData.id_categoria=i),items:l.categoriaOptions,rules:l.rules.id_categoria,label:"Categoria",placeholder:"Selecione a categoria","prepend-inner-icon":"mdi-tag",variant:"outlined",required:""},null,8,["modelValue","items","rules"])]),_:1}),r(d,{cols:"12",md:"6"},{default:t(()=>[r(u,{modelValue:o.formData.id_marca,"onUpdate:modelValue":a[3]||(a[3]=i=>o.formData.id_marca=i),items:l.marcaOptions,rules:l.rules.id_marca,label:"Marca",placeholder:"Selecione a marca","prepend-inner-icon":"mdi-tag-multiple",variant:"outlined",required:""},null,8,["modelValue","items","rules"])]),_:1}),r(d,{cols:"12",md:"6"},{default:t(()=>[r(u,{modelValue:o.formData.id_unidade_medida,"onUpdate:modelValue":a[4]||(a[4]=i=>o.formData.id_unidade_medida=i),items:l.unidadeMedidaOptions,rules:l.rules.id_unidade_medida,label:"Unidade de Medida",placeholder:"Selecione a unidade","prepend-inner-icon":"mdi-scale",variant:"outlined",required:""},null,8,["modelValue","items","rules"])]),_:1}),r(d,{cols:"12",md:"6"},{default:t(()=>[r(s,{modelValue:o.formData.estoque_minimo,"onUpdate:modelValue":a[5]||(a[5]=i=>o.formData.estoque_minimo=i),modelModifiers:{number:!0},rules:l.rules.estoque_minimo,label:"Estoque Mínimo",placeholder:"0","prepend-inner-icon":"mdi-warehouse",type:"number",variant:"outlined",required:""},null,8,["modelValue","rules"])]),_:1}),r(d,{cols:"12"},{default:t(()=>[r(T,{modelValue:o.formData.is_perecivel,"onUpdate:modelValue":a[6]||(a[6]=i=>o.formData.is_perecivel=i),label:"Produto Perecível",color:"primary"},null,8,["modelValue"])]),_:1}),o.formData.is_perecivel?(_(),w(d,{key:0,cols:"12",md:"6"},{default:t(()=>[r(s,{modelValue:o.formData.data_validade,"onUpdate:modelValue":a[7]||(a[7]=i=>o.formData.data_validade=i),rules:l.rules.data_validade,label:"Data de Validade",placeholder:"YYYY-MM-DD","prepend-inner-icon":"mdi-calendar",type:"date",variant:"outlined",required:""},null,8,["modelValue","rules"])]),_:1})):N("",!0),r(d,{cols:"12",md:"6"},{default:t(()=>[r(s,{modelValue:o.custoUnitarioInput,"onUpdate:modelValue":[a[8]||(a[8]=i=>o.custoUnitarioInput=i),l.onCustoUnitarioInput],rules:l.rules.custo_unitario,label:"Custo Unitário",placeholder:"R$ 0,00","prepend-inner-icon":"mdi-currency-usd",variant:"outlined",required:""},null,8,["modelValue","rules","onUpdate:modelValue"])]),_:1}),r(d,{cols:"12",md:"6"},{default:t(()=>[r(s,{modelValue:o.precoVendaInput,"onUpdate:modelValue":[a[9]||(a[9]=i=>o.precoVendaInput=i),l.onPrecoVendaInput],rules:l.rules.preco_venda,label:"Preço de Venda",placeholder:"R$ 0,00","prepend-inner-icon":"mdi-currency-usd",variant:"outlined",required:""},null,8,["modelValue","rules","onUpdate:modelValue"])]),_:1}),r(d,{cols:"12",md:"6"},{default:t(()=>[r(s,{modelValue:o.formData.quantidade,"onUpdate:modelValue":a[10]||(a[10]=i=>o.formData.quantidade=i),modelModifiers:{number:!0},rules:l.rules.quantidade,label:"Quantidade",placeholder:"0","prepend-inner-icon":"mdi-counter",type:"number",variant:"outlined",required:""},null,8,["modelValue","rules"])]),_:1}),r(d,{cols:"12",md:"6"},{default:t(()=>[r(u,{modelValue:o.formData.id_localizacao,"onUpdate:modelValue":a[11]||(a[11]=i=>o.formData.id_localizacao=i),items:l.localizacaoOptions,rules:l.rules.id_localizacao,label:"Localização",placeholder:"Selecione a localização","prepend-inner-icon":"mdi-map-marker",variant:"outlined",required:""},null,8,["modelValue","items","rules"])]),_:1}),r(d,{cols:"12"},{default:t(()=>[r(u,{modelValue:o.formData.id_fornecedor,"onUpdate:modelValue":a[12]||(a[12]=i=>o.formData.id_fornecedor=i),items:l.fornecedorOptions,rules:l.rules.id_fornecedor,label:"Fornecedor",placeholder:"Selecione o fornecedor","prepend-inner-icon":"mdi-truck",variant:"outlined",required:""},null,8,["modelValue","items","rules"])]),_:1})]),_:1}),r(f,{class:"mt-6"},{default:t(()=>[r(d,{cols:"12",class:"text-center"},{default:t(()=>[r(g,{color:"primary",disabled:!o.validForm||o.saving,loading:o.saving,size:"large",type:"submit",variant:"elevated"},{default:t(()=>[r(p,{class:"mr-2"},{default:t(()=>[...a[17]||(a[17]=[n("mdi-content-save",-1)])]),_:1}),n(" "+v(o.saving?"Salvando...":"Salvar Produto"),1)]),_:1},8,["disabled","loading"]),r(g,{class:"ml-4",color:"grey",size:"large",variant:"outlined",onClick:l.limparFormulario},{default:t(()=>[r(p,{class:"mr-2"},{default:t(()=>[...a[18]||(a[18]=[n("mdi-refresh",-1)])]),_:1}),a[19]||(a[19]=n(" Limpar ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),r(A,{modelValue:e.snackbar,"onUpdate:modelValue":a[14]||(a[14]=i=>e.snackbar=i),color:e.snackbarColor,elevation:"8",location:"top right",timeout:e.snackbarTimeout},{default:t(()=>[B("div",Q,[r(p,{class:"mr-2",icon:e.snackbarColor==="success"?"mdi-check-circle":"mdi-alert-circle"},null,8,["icon"]),n(" "+v(e.snackbarText),1)])]),_:1},8,["modelValue","color","timeout"])])}typeof V=="function"&&V(D);const se=F(D,[["render",j],["__scopeId","data-v-4422751b"]]);export{se as default};
