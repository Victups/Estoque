import{s as S}from"./snackbar-BTqzwliu.js";import{p as _,s as V}from"./index-BNH3mZEl.js";import"./uf.service-Bn8JpA_W.js";import{C,B as U,U as w,L as y,P as k}from"./product.service-DE7QUhp7.js";import{L as z,V as u}from"./VAutocomplete-e8hwRa83.js";import{S as I}from"./supplier.service-D8RTGJYr.js";import{u as x,_ as F,f as P,o as D,a as r,w as i,b as v,e as s,g as M,c as R,h as B,t as b}from"./index-Dh7kI4jI.js";import{b as h}from"./route-block-B_A1xBdJ.js";import{V as g,a as d,b as L,h as N,d as m,c as O,f as E}from"./VCard-Cmc6vJ8q.js";import{a as f,V as n}from"./VTextField-BR1_iDts.js";import{V as T}from"./VForm-BXt1Yd4O.js";import{V as A}from"./VCheckbox-DWoEZdva.js";import{V as Y}from"./VSnackbar-C9s1oWwd.js";import"./VSelect-DK1SXm7i.js";import"./VMenu-x2Orytf9.js";import"./tag-CE7kSe09.js";import"./VChip-DgJE4qLc.js";import"./filter-B-yaYJPB.js";import"./ssrBoot-CK06tIrr.js";const q={name:"CadastroProdutosPage",mixins:[S],setup(){return{authStore:x()}},data(){return{validForm:!1,saving:!1,formRef:null,categorias:[],marcas:[],unidadesMedida:[],fornecedores:[],localizacoes:[],formData:{nome:"",descricao:"",id_categoria:null,id_marca:null,id_unidade_medida:null,estoque_minimo:0,is_perecivel:!1,data_validade:null,custo_unitario:0,preco_venda:0,quantidade:0,id_localizacao:null,id_fornecedor:null},custoUnitarioInput:"",precoVendaInput:""}},computed:{rules(){return{nome:[_.required,V.minLength(3)],descricao:[_.required,V.minLength(10)],id_categoria:[e=>!!e||"Categoria é obrigatória"],id_marca:[e=>!!e||"Marca é obrigatória"],id_unidade_medida:[e=>!!e||"Unidade de medida é obrigatória"],estoque_minimo:[e=>e>=0||"Estoque mínimo deve ser maior ou igual a 0"],data_validade:[e=>this.formData.is_perecivel?!!e||"Data de validade é obrigatória para produtos perecíveis":!0],custo_unitario:[e=>e>0||"Custo unitário deve ser maior que 0"],preco_venda:[e=>e>0||"Preço de venda deve ser maior que 0"],quantidade:[e=>e>0||"Quantidade deve ser maior que 0"],id_localizacao:[e=>!!e||"Localização é obrigatória"],id_fornecedor:[e=>!!e||"Fornecedor é obrigatório"]}},categoriaOptions(){return this.categorias.map(e=>({title:e.nome,value:e.id}))},marcaOptions(){return this.marcas.map(e=>({title:e.nome,value:e.id}))},unidadeMedidaOptions(){return this.unidadesMedida.map(e=>({title:`${e.descricao} (${e.abreviacao})`,value:e.id}))},fornecedorOptions(){return this.fornecedores.map(e=>({title:e.nome,value:e.id}))},localizacaoOptions(){return this.localizacoes.map(e=>({title:`${e.deposito_nome} - ${e.corredor||""} ${e.prateleira||""} ${e.secao||""}`.trim(),value:e.id}))}},methods:{formatBRLFromCents(e){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e/100)},toCents(e){const a=e.replace(/[^\d]/g,"");return parseInt(a)||0},toNumber(e){const a=e.replace(/[^\d,]/g,"").replace(",",".");return parseFloat(a)||0},formatNumber(e){return new Intl.NumberFormat("pt-BR").format(e)},onCustoUnitarioInput(e){const a=this.toCents(e);this.custoUnitarioInput=this.formatBRLFromCents(a),this.formData.custo_unitario=a},onPrecoVendaInput(e){const a=this.toCents(e);this.precoVendaInput=this.formatBRLFromCents(a),this.formData.preco_venda=a},limparFormulario(){this.formData={nome:"",descricao:"",id_categoria:null,id_marca:null,id_unidade_medida:null,estoque_minimo:0,is_perecivel:!1,data_validade:null,custo_unitario:0,preco_venda:0,quantidade:0,id_localizacao:null,id_fornecedor:null},this.custoUnitarioInput="",this.precoVendaInput="",this.formRef&&this.formRef.reset()},async salvarProduto(){if(this.validForm){this.saving=!0;try{const e={nome:this.formData.nome,descricao:this.formData.descricao,codigo:"",id_categoria:this.formData.id_categoria,id_marca:this.formData.id_marca,id_unidade_medida:this.formData.id_unidade_medida,estoque_minimo:this.formData.estoque_minimo,is_perecivel:this.formData.is_perecivel,responsavel_cadastro:(this.authStore.userName,1),usuario_log_id:(this.authStore.userName,1),data_cadastro:new Date().toISOString()},a=await k.create(e),c=this.formData.data_validade||new Date().toISOString().split("T")[0],p=new Date().toISOString().split("T")[0],o={id_produto:a.id,codigo_lote:"",data_validade:c,quantidade:this.formData.quantidade,data_entrada:p,custo_unitario:this.formData.custo_unitario,preco_venda:this.formData.preco_venda,responsavel_cadastro:(this.authStore.userName,1),usuario_log_id:(this.authStore.userName,1),id_localizacao:this.formData.id_localizacao};await z.create(o),this.showSuccess("Produto cadastrado com sucesso!"),this.limparFormulario()}catch(e){console.error("Erro ao salvar produto:",e),this.showError("Erro ao cadastrar produto")}finally{this.saving=!1}}},async loadData(){try{const[e,a,c,p,o]=await Promise.all([C.getAll(),U.getAll(),w.getAll(),I.getAll(),y.getAllComplete()]);this.categorias=e,this.marcas=a,this.unidadesMedida=c,this.fornecedores=p,this.localizacoes=o}catch(e){console.error("Erro ao carregar dados:",e),this.showError("Erro ao carregar dados")}}},mounted(){this.loadData()}},j={class:"cadastro-produtos-page"},Q={class:"d-flex align-center"},G={class:"d-flex flex-column flex-sm-row justify-center align-center gap-3"},H={class:"d-flex align-center"};function J(e,a,c,p,o,t){return D(),P("div",j,[r(E,{fluid:""},{default:i(()=>[r(g,null,{default:i(()=>[r(d,{cols:"12"},{default:i(()=>[r(L,{class:"elevation-8"},{default:i(()=>[r(N,{class:"text-h4 text-center py-6 d-flex align-center justify-space-between"},{default:i(()=>[v("div",Q,[r(m,{class:"mr-3",color:"primary",size:"large"},{default:i(()=>[...a[17]||(a[17]=[s("mdi-package-variant-plus",-1)])]),_:1}),a[18]||(a[18]=s(" Cadastro de Produtos ",-1))]),r(f,{icon:"mdi-close",variant:"text",color:"white",size:"large",onClick:a[0]||(a[0]=l=>e.$router.push("/produtos"))})]),_:1}),r(O,null,{default:i(()=>[r(T,{ref:"formRef",modelValue:o.validForm,"onUpdate:modelValue":a[15]||(a[15]=l=>o.validForm=l),onSubmit:M(t.salvarProduto,["prevent"])},{default:i(()=>[r(g,null,{default:i(()=>[r(d,{cols:"12",sm:"6",md:"6",lg:"6"},{default:i(()=>[r(n,{modelValue:o.formData.nome,"onUpdate:modelValue":a[1]||(a[1]=l=>o.formData.nome=l),rules:t.rules.nome,label:"Nome do Produto",placeholder:"Digite o nome do produto","prepend-inner-icon":"mdi-package-variant",variant:"outlined",required:""},null,8,["modelValue","rules"])]),_:1}),r(d,{cols:"12",sm:"6",md:"6",lg:"6"},{default:i(()=>[r(n,{modelValue:o.formData.descricao,"onUpdate:modelValue":a[2]||(a[2]=l=>o.formData.descricao=l),rules:t.rules.descricao,label:"Descrição",placeholder:"Descreva o produto","prepend-inner-icon":"mdi-text",variant:"outlined",required:""},null,8,["modelValue","rules"])]),_:1}),r(d,{cols:"12",sm:"6",md:"6",lg:"6"},{default:i(()=>[r(u,{modelValue:o.formData.id_categoria,"onUpdate:modelValue":a[3]||(a[3]=l=>o.formData.id_categoria=l),items:t.categoriaOptions,rules:t.rules.id_categoria,label:"Categoria",placeholder:"Selecione a categoria","prepend-inner-icon":"mdi-tag",variant:"outlined",required:""},null,8,["modelValue","items","rules"])]),_:1}),r(d,{cols:"12",sm:"6",md:"6",lg:"6"},{default:i(()=>[r(u,{modelValue:o.formData.id_marca,"onUpdate:modelValue":a[4]||(a[4]=l=>o.formData.id_marca=l),items:t.marcaOptions,rules:t.rules.id_marca,label:"Marca",placeholder:"Selecione a marca","prepend-inner-icon":"mdi-tag-multiple",variant:"outlined",required:""},null,8,["modelValue","items","rules"])]),_:1}),r(d,{cols:"12",sm:"6",md:"6",lg:"6"},{default:i(()=>[r(u,{modelValue:o.formData.id_unidade_medida,"onUpdate:modelValue":a[5]||(a[5]=l=>o.formData.id_unidade_medida=l),items:t.unidadeMedidaOptions,rules:t.rules.id_unidade_medida,label:"Unidade de Medida",placeholder:"Selecione a unidade","prepend-inner-icon":"mdi-scale",variant:"outlined",required:""},null,8,["modelValue","items","rules"])]),_:1}),r(d,{cols:"12",sm:"6",md:"6",lg:"6"},{default:i(()=>[r(n,{modelValue:o.formData.estoque_minimo,"onUpdate:modelValue":a[6]||(a[6]=l=>o.formData.estoque_minimo=l),modelModifiers:{number:!0},rules:t.rules.estoque_minimo,label:"Estoque Mínimo",placeholder:"0","prepend-inner-icon":"mdi-warehouse",type:"number",variant:"outlined",required:""},null,8,["modelValue","rules"])]),_:1}),r(d,{cols:"12"},{default:i(()=>[r(A,{modelValue:o.formData.is_perecivel,"onUpdate:modelValue":a[7]||(a[7]=l=>o.formData.is_perecivel=l),label:"Produto Perecível",color:"primary"},null,8,["modelValue"])]),_:1}),o.formData.is_perecivel?(D(),R(d,{key:0,cols:"12",sm:"6",md:"6",lg:"6"},{default:i(()=>[r(n,{modelValue:o.formData.data_validade,"onUpdate:modelValue":a[8]||(a[8]=l=>o.formData.data_validade=l),rules:t.rules.data_validade,label:"Data de Validade",placeholder:"YYYY-MM-DD","prepend-inner-icon":"mdi-calendar",type:"date",variant:"outlined",required:""},null,8,["modelValue","rules"])]),_:1})):B("",!0),r(d,{cols:"12",sm:"6",md:"6",lg:"6"},{default:i(()=>[r(n,{modelValue:o.custoUnitarioInput,"onUpdate:modelValue":[a[9]||(a[9]=l=>o.custoUnitarioInput=l),t.onCustoUnitarioInput],rules:t.rules.custo_unitario,label:"Custo Unitário",placeholder:"R$ 0,00","prepend-inner-icon":"mdi-currency-usd",variant:"outlined",required:""},null,8,["modelValue","rules","onUpdate:modelValue"])]),_:1}),r(d,{cols:"12",sm:"6",md:"6",lg:"6"},{default:i(()=>[r(n,{modelValue:o.precoVendaInput,"onUpdate:modelValue":[a[10]||(a[10]=l=>o.precoVendaInput=l),t.onPrecoVendaInput],rules:t.rules.preco_venda,label:"Preço de Venda",placeholder:"R$ 0,00","prepend-inner-icon":"mdi-currency-usd",variant:"outlined",required:""},null,8,["modelValue","rules","onUpdate:modelValue"])]),_:1}),r(d,{cols:"12",sm:"6",md:"6",lg:"6"},{default:i(()=>[r(n,{modelValue:o.formData.quantidade,"onUpdate:modelValue":a[11]||(a[11]=l=>o.formData.quantidade=l),modelModifiers:{number:!0},rules:t.rules.quantidade,label:"Quantidade",placeholder:"0","prepend-inner-icon":"mdi-counter",type:"number",variant:"outlined",required:""},null,8,["modelValue","rules"])]),_:1}),r(d,{cols:"12",sm:"6",md:"6",lg:"6"},{default:i(()=>[r(u,{modelValue:o.formData.id_localizacao,"onUpdate:modelValue":a[12]||(a[12]=l=>o.formData.id_localizacao=l),items:t.localizacaoOptions,rules:t.rules.id_localizacao,label:"Localização",placeholder:"Selecione a localização","prepend-inner-icon":"mdi-map-marker",variant:"outlined",required:""},null,8,["modelValue","items","rules"])]),_:1}),r(d,{cols:"12"},{default:i(()=>[r(u,{modelValue:o.formData.id_fornecedor,"onUpdate:modelValue":a[13]||(a[13]=l=>o.formData.id_fornecedor=l),items:t.fornecedorOptions,rules:t.rules.id_fornecedor,label:"Fornecedor",placeholder:"Selecione o fornecedor","prepend-inner-icon":"mdi-truck",variant:"outlined",required:""},null,8,["modelValue","items","rules"])]),_:1})]),_:1}),r(g,{class:"mt-6"},{default:i(()=>[r(d,{cols:"12",class:"text-center"},{default:i(()=>[v("div",G,[r(f,{color:"primary",disabled:!o.validForm||o.saving,loading:o.saving,size:"large",type:"submit",variant:"elevated",class:"flex-grow-1 flex-sm-grow-0"},{default:i(()=>[r(m,{class:"mr-2"},{default:i(()=>[...a[19]||(a[19]=[s("mdi-content-save",-1)])]),_:1}),s(" "+b(o.saving?"Salvando...":"Salvar Produto"),1)]),_:1},8,["disabled","loading"]),r(f,{color:"grey",size:"large",variant:"outlined",class:"flex-grow-1 flex-sm-grow-0",onClick:t.limparFormulario},{default:i(()=>[r(m,{class:"mr-2"},{default:i(()=>[...a[20]||(a[20]=[s("mdi-refresh",-1)])]),_:1}),a[21]||(a[21]=s(" Limpar ",-1))]),_:1},8,["onClick"]),r(f,{color:"error",size:"large",variant:"outlined",class:"flex-grow-1 flex-sm-grow-0",onClick:a[14]||(a[14]=l=>e.$router.push("/produtos"))},{default:i(()=>[r(m,{class:"mr-2"},{default:i(()=>[...a[22]||(a[22]=[s("mdi-close",-1)])]),_:1}),a[23]||(a[23]=s(" Cancelar ",-1))]),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),r(Y,{modelValue:e.snackbar,"onUpdate:modelValue":a[16]||(a[16]=l=>e.snackbar=l),color:e.snackbarColor,elevation:"8",location:"top right",timeout:e.snackbarTimeout},{default:i(()=>[v("div",H,[r(m,{class:"mr-2",icon:e.snackbarColor==="success"?"mdi-check-circle":"mdi-alert-circle"},null,8,["icon"]),s(" "+b(e.snackbarText),1)])]),_:1},8,["modelValue","color","timeout"])])}typeof h=="function"&&h(q);const fe=F(q,[["render",J],["__scopeId","data-v-3735cc94"]]);export{fe as default};
