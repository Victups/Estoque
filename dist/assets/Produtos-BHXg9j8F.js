import{i as G,p as O,j as K,k as H,l as J,m as W,n as X,b as o,q as V,F as z,s as Y,v as Z,_ as $,c as D,o as u,w as l,a,e as i,f as m,h as k,t as n,g as w,r as N}from"./index-2CK1TBd1.js";import{L as ee}from"./lote.service-DRwDZ3qN.js";import{P as L}from"./product.service-6MmcmfrT.js";import{s as te}from"./snackbar-BTqzwliu.js";import{b as A}from"./route-block-B_A1xBdJ.js";import{u as oe,g as ae,m as le,V as E,a as P,b as _,h as S,d as b,c as T,e as se,i as re,j as q,f as ie}from"./VCard-C0Nnn3PC.js";import{a as f,b as ne,c as de}from"./VTextField-Dl59xlA2.js";import{V as ue}from"./VAlert-B24Zed_l.js";import{V as ce,a as me}from"./VDataTable-g9Pk3cLs.js";import{u as pe,m as ge}from"./tag-ClhzHHXz.js";import{V as B}from"./VTooltip-D8FHFb_J.js";import{V as j}from"./VChip-ijcJUYKv.js";import{V as F}from"./VDialog-D3PXHU9z.js";import{V as I}from"./VSpacer-CVnO6Leu.js";import{V as fe}from"./VSnackbar-Dyx3aGnx.js";import"./ssrBoot-DL-QNHNL.js";import"./VSelect-BDnerYRz.js";import"./VMenu-CzW1lCu_.js";import"./filter-DzHhRroJ.js";const ve={actions:"button@2",article:"heading, paragraph",avatar:"avatar",button:"button",card:"image, heading","card-avatar":"image, list-item-avatar",chip:"chip","date-picker":"list-item, heading, divider, date-picker-options, date-picker-days, actions","date-picker-options":"text, avatar@2","date-picker-days":"avatar@28",divider:"divider",heading:"heading",image:"image","list-item":"text","list-item-avatar":"avatar, text","list-item-two-line":"sentences","list-item-avatar-two-line":"avatar, sentences","list-item-three-line":"paragraph","list-item-avatar-three-line":"avatar, paragraph",ossein:"ossein",paragraph:"text@3",sentences:"text@2",subtitle:"text",table:"table-heading, table-thead, table-tbody, table-tfoot","table-heading":"chip, text","table-thead":"heading@6","table-tbody":"table-row-divider@6","table-row-divider":"table-row, divider","table-row":"text@6","table-tfoot":"text@2, avatar@2",text:"text"};function be(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return o("div",{class:Z(["v-skeleton-loader__bone",`v-skeleton-loader__${t}`])},[e])}function M(t){const[e,d]=t.split("@");return Array.from({length:d}).map(()=>C(e))}function C(t){let e=[];if(!t)return e;const d=ve[t];if(t!==d){if(t.includes(","))return Q(t);if(t.includes("@"))return M(t);d.includes(",")?e=Q(d):d.includes("@")?e=M(d):d&&e.push(C(d))}return[be(t,e)]}function Q(t){return t.replace(/\s/g,"").split(",").map(C)}const xe=O({boilerplate:Boolean,color:String,loading:Boolean,loadingText:{type:String,default:"$vuetify.loading"},type:{type:[String,Array],default:"ossein"},...ge(),...le(),...Y()},"VSkeletonLoader"),ye=G()({name:"VSkeletonLoader",inheritAttrs:!1,props:xe(),setup(t,e){let{attrs:d,slots:x}=e;const{backgroundColorClasses:r,backgroundColorStyles:c}=oe(()=>t.color),{dimensionStyles:s}=pe(t),{elevationClasses:p}=ae(t),{themeClasses:g}=K(t),{t:h}=H(),v=J(()=>C(W(t.type).join(",")));return X(()=>{const y=!x.default||t.loading,U=t.boilerplate||!y?{}:{ariaLive:"polite",ariaLabel:h(t.loadingText),role:"alert"};return o(z,null,[y?o("div",V({class:["v-skeleton-loader",{"v-skeleton-loader--boilerplate":t.boilerplate},g.value,r.value,p.value],style:[c.value,s.value]},U,d),[v.value]):x.default?.()])}),{}}}),R={name:"ProdutosPage",mixins:[te],data(){return{allProducts:[],allProductLots:[],loading:!1,error:null,headers:[{title:"Produto",key:"nome",sortable:!0},{title:"Estoque Total",key:"totalQuantity",sortable:!0},{title:"Validade Próxima",key:"nearestExpiry",sortable:!1},{title:"Status",key:"status",sortable:!0},{title:"Ações",key:"actions",sortable:!1,width:"140px"}],detailDialog:!1,detailLoading:!1,selectedProductDetail:null,deleteDialog:!1,deleteLoading:!1,productToDelete:null}},computed:{displayProducts(){const t=new Map;for(const e of this.allProductLots){const d=t.get(e.id_produto)||[];d.push(e),t.set(e.id_produto,d)}return this.allProducts.map(e=>{const d=t.get(e.id)||[],x=d.reduce((v,y)=>v+y.quantidade,0),s=d.filter(v=>new Date(v.data_validade)>new Date).slice().sort((v,y)=>new Date(v.data_validade).getTime()-new Date(y.data_validade).getTime())[0],p=s?new Date(s.data_validade).toLocaleDateString("pt-BR"):"N/A";let g="OK";const h=new Date;return h.setDate(h.getDate()+30),x<e.estoque_minimo?g="Estoque Baixo":s&&new Date(s.data_validade)<h&&(g="Vencimento Próximo"),{id:e.id,nome:e.nome,totalQuantity:x,nearestExpiry:p,status:g}})}},mounted(){this.fetchData()},methods:{async fetchData(){this.loading=!0,this.error=null;try{const[t,e]=await Promise.all([L.getAll(),ee.getAll()]);this.allProducts=t,this.allProductLots=e}catch(t){console.error("Erro ao carregar produtos:",t),this.error=t?.message||"Ocorreu um erro desconhecido",this.showError("Não foi possível carregar os produtos")}finally{this.loading=!1}},getStatusColor(t){switch(t){case"Estoque Baixo":return"warning";case"Vencimento Próximo":return"error";default:return"success"}},getStatusIcon(t){switch(t){case"Estoque Baixo":return"mdi-alert-circle";case"Vencimento Próximo":return"mdi-clock-alert";default:return"mdi-check-circle"}},formatDate(t){if(!t)return"-";const e=new Date(t);return Number.isNaN(e.getTime())?"-":e.toLocaleString("pt-BR")},async openDetails(t){this.detailDialog=!0,this.detailLoading=!0,this.selectedProductDetail=null;try{this.selectedProductDetail=await L.getDetail(t.id)}catch(e){console.error("Erro ao carregar detalhes do produto:",e),this.showError("Não foi possível carregar os detalhes do produto"),this.detailDialog=!1}finally{this.detailLoading=!1}},editProduct(t){this.$router.push({name:"EditarProduto",params:{id:t.id}})},confirmDelete(t){this.productToDelete=t,this.deleteDialog=!0},async deleteProduct(){if(this.productToDelete){this.deleteLoading=!0;try{await L.delete(this.productToDelete.id),this.showSuccess("Produto excluído com sucesso"),this.deleteDialog=!1,this.productToDelete=null,await this.fetchData()}catch(t){console.error("Erro ao excluir produto:",t),this.showError("Erro ao excluir produto")}finally{this.deleteLoading=!1}}}}},he={class:"d-flex align-center"},De={key:0,class:"text-center py-8"},ke={class:"d-flex align-center py-2"},Pe={class:"font-weight-medium"},_e={class:"d-flex align-center"},Ve={class:"font-weight-medium"},Ce={class:"d-flex align-center"},we={class:"d-flex align-center gap-2"},Le={class:"d-flex align-center"},Ee={key:1},Se={class:"mb-1"},Te={class:"mb-1"},Be={class:"mb-1"},ze={class:"mb-1"},Ne={class:"mb-1"},Ae={class:"mb-1"},qe={key:0},je={class:"mb-1"},Fe={class:"mb-1"},Ie={class:"mb-1"},Me={class:"mb-1"},Qe={key:0,class:"d-flex flex-wrap gap-2 mb-4"},Re={key:1,class:"text-grey mb-4"},Ue={key:0},Ge={key:2,class:"text-center text-grey"},Oe={class:"d-flex align-center"};function Ke(t,e,d,x,r,c){return u(),D(ie,{class:"pa-6",fluid:""},{default:l(()=>[a(E,{class:"mb-6"},{default:l(()=>[a(P,{cols:"12"},{default:l(()=>[a(_,{class:"rounded-lg",elevation:"0"},{default:l(()=>[a(S,{class:"d-flex align-center justify-space-between pa-6"},{default:l(()=>[o("div",he,[a(b,{class:"mr-3",color:"primary",icon:"mdi-package-variant",size:"32"}),e[6]||(e[6]=o("div",null,[o("h1",{class:"text-h4 font-weight-bold mb-1"}," Gerenciamento de Produtos "),o("p",{class:"text-subtitle-2 text-medium-emphasis mb-0"}," Gerencie todos os produtos e estoque do sistema ")],-1))]),o("div",null,[a(f,{color:"primary","prepend-icon":"mdi-package-variant-plus",variant:"elevated",to:{name:"CadastroProdutos"}},{default:l(()=>[...e[7]||(e[7]=[i(" Cadastrar Produto ",-1)])]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1}),a(E,null,{default:l(()=>[a(P,{cols:"12"},{default:l(()=>[a(_,{class:"rounded-lg",elevation:"2"},{default:l(()=>[a(T,{class:"pa-6"},{default:l(()=>[r.loading?(u(),m("div",De,[a(ne,{color:"primary",indeterminate:"",size:"64"}),e[8]||(e[8]=o("p",{class:"text-subtitle-1 mt-4"}," Carregando produtos... ",-1))])):k("",!0),r.error?(u(),D(ue,{key:1,class:"mb-4",closable:"",type:"error",variant:"tonal"},{default:l(()=>[i(n(r.error),1)]),_:1})):k("",!0),!r.loading&&!r.error?(u(),D(ce,{key:2,class:"elevation-1 rounded-lg",headers:r.headers,items:c.displayProducts,"items-per-page-text":"Produtos por página",loading:r.loading,"loading-text":"Carregando produtos...","no-data-text":"Nenhum produto encontrado"},{"item.nome":l(({item:s})=>[o("div",ke,[a(se,{class:"mr-3",color:"primary",size:"40"},{default:l(()=>[a(b,null,{default:l(()=>[...e[9]||(e[9]=[i("mdi-package-variant",-1)])]),_:1})]),_:1}),o("span",Pe,n(s.nome),1)])]),"item.totalQuantity":l(({item:s})=>[o("div",_e,[a(b,{class:"mr-2 text-medium-emphasis",icon:"mdi-package-variant-closed",size:"small"}),o("span",Ve,n(s.totalQuantity),1)])]),"item.nearestExpiry":l(({item:s})=>[o("div",Ce,[a(b,{class:"mr-2 text-medium-emphasis",icon:"mdi-calendar",size:"small"}),o("span",null,n(s.nearestExpiry),1)])]),"item.status":l(({item:s})=>[a(j,{color:c.getStatusColor(s.status),size:"small",variant:"flat"},{default:l(()=>[a(b,{icon:c.getStatusIcon(s.status),size:"small",start:""},null,8,["icon"]),i(" "+n(s.status),1)]),_:2},1032,["color"])]),"item.actions":l(({item:s})=>[o("div",we,[a(B,{text:"Ver detalhes",location:"top"},{activator:l(({props:p})=>[a(f,V(p,{color:"info",icon:"mdi-eye",size:"small",variant:"text",onClick:w(g=>c.openDetails(s),["stop"])}),null,16,["onClick"])]),_:2},1024),a(B,{text:"Editar produto",location:"top"},{activator:l(({props:p})=>[a(f,V(p,{color:"primary",icon:"mdi-pencil",size:"small",variant:"text",onClick:w(g=>c.editProduct(s),["stop"])}),null,16,["onClick"])]),_:2},1024),a(B,{text:"Excluir produto",location:"top"},{activator:l(({props:p})=>[a(f,V(p,{color:"error",icon:"mdi-delete",size:"small",variant:"text",onClick:w(g=>c.confirmDelete(s),["stop"])}),null,16,["onClick"])]),_:2},1024)])]),loading:l(()=>[a(ye,{type:"table-row@5"})]),_:2},1032,["headers","items","loading"])):k("",!0),a(F,{modelValue:r.detailDialog,"onUpdate:modelValue":e[2]||(e[2]=s=>r.detailDialog=s),"max-width":"720"},{default:l(()=>[a(_,null,{default:l(()=>[a(S,{class:"d-flex align-center justify-space-between"},{default:l(()=>[o("div",Le,[a(b,{class:"mr-2",color:"primary"},{default:l(()=>[...e[10]||(e[10]=[i("mdi-eye",-1)])]),_:1}),e[11]||(e[11]=i(" Detalhes do Produto ",-1))]),a(f,{icon:"mdi-close",variant:"text",onClick:e[0]||(e[0]=s=>r.detailDialog=!1)})]),_:1}),a(T,null,{default:l(()=>[r.detailLoading?(u(),D(re,{key:0,color:"primary",indeterminate:"",class:"mb-4"})):r.selectedProductDetail?(u(),m("div",Ee,[a(E,null,{default:l(()=>[a(P,{cols:"12",md:"6"},{default:l(()=>[e[18]||(e[18]=o("h4",{class:"text-subtitle-2 text-grey"},"Informações Gerais",-1)),o("p",Se,[e[12]||(e[12]=o("strong",null,"Nome:",-1)),i(" "+n(r.selectedProductDetail.nome),1)]),o("p",Te,[e[13]||(e[13]=o("strong",null,"Código:",-1)),i(" "+n(r.selectedProductDetail.codigo),1)]),o("p",Be,[e[14]||(e[14]=o("strong",null,"Descrição:",-1)),i(" "+n(r.selectedProductDetail.descricao||"-"),1)]),o("p",ze,[e[15]||(e[15]=o("strong",null,"Categoria:",-1)),i(" "+n(r.selectedProductDetail.categoria_nome||"-"),1)]),o("p",Ne,[e[16]||(e[16]=o("strong",null,"Marca:",-1)),i(" "+n(r.selectedProductDetail.marca_nome||"-"),1)]),o("p",Ae,[e[17]||(e[17]=o("strong",null,"Unidade:",-1)),i(" "+n(r.selectedProductDetail.unidade_descricao||"-")+" ",1),r.selectedProductDetail.unidade_abreviacao?(u(),m("span",qe," ("+n(r.selectedProductDetail.unidade_abreviacao)+") ",1)):k("",!0)])]),_:1}),a(P,{cols:"12",md:"6"},{default:l(()=>[e[23]||(e[23]=o("h4",{class:"text-subtitle-2 text-grey"},"Auditoria",-1)),o("p",je,[e[19]||(e[19]=o("strong",null,"Responsável cadastro:",-1)),i(" "+n(r.selectedProductDetail.responsavel_nome||"-"),1)]),o("p",Fe,[e[20]||(e[20]=o("strong",null,"Último usuário:",-1)),i(" "+n(r.selectedProductDetail.usuario_log_nome||"-"),1)]),o("p",Ie,[e[21]||(e[21]=o("strong",null,"Criado em:",-1)),i(" "+n(c.formatDate(r.selectedProductDetail.created_at)),1)]),o("p",Me,[e[22]||(e[22]=o("strong",null,"Atualizado em:",-1)),i(" "+n(c.formatDate(r.selectedProductDetail.updated_at)),1)])]),_:1})]),_:1}),a(de,{class:"my-4"}),e[26]||(e[26]=o("h4",{class:"text-subtitle-2 text-grey mb-2"},"Fornecedores Vinculados",-1)),r.selectedProductDetail.fornecedores?.length?(u(),m("div",Qe,[(u(!0),m(z,null,N(r.selectedProductDetail.fornecedores,s=>(u(),D(j,{key:s.id_fornecedor,color:"primary",variant:"tonal",size:"small"},{default:l(()=>[i(n(s.nome),1)]),_:2},1024))),128))])):(u(),m("p",Re,"Nenhum fornecedor vinculado.")),e[27]||(e[27]=o("h4",{class:"text-subtitle-2 text-grey mb-2"},"Lotes cadastrados",-1)),a(me,{density:"compact"},{default:l(()=>[e[25]||(e[25]=o("thead",null,[o("tr",null,[o("th",null,"Código"),o("th",null,"Quantidade"),o("th",null,"Validade"),o("th",null,"Localização")])],-1)),o("tbody",null,[(u(!0),m(z,null,N(r.selectedProductDetail.lotes,s=>(u(),m("tr",{key:s.id},[o("td",null,n(s.codigo_lote),1),o("td",null,n(s.quantidade),1),o("td",null,n(s.data_validade?c.formatDate(s.data_validade):"-"),1),o("td",null,n(s.id_localizacao||"-"),1)]))),128)),r.selectedProductDetail.lotes?.length?k("",!0):(u(),m("tr",Ue,[...e[24]||(e[24]=[o("td",{class:"text-grey",colspan:"4"},"Sem lotes registrados.",-1)])]))])]),_:1})])):(u(),m("div",Ge," Nenhuma informação disponível. "))]),_:1}),a(q,null,{default:l(()=>[a(I),a(f,{color:"primary",variant:"text",onClick:e[1]||(e[1]=s=>r.detailDialog=!1)},{default:l(()=>[...e[28]||(e[28]=[i(" Fechar ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(F,{modelValue:r.deleteDialog,"onUpdate:modelValue":e[4]||(e[4]=s=>r.deleteDialog=s),"max-width":"480"},{default:l(()=>[a(_,null,{default:l(()=>[a(S,{class:"text-h6"},{default:l(()=>[...e[29]||(e[29]=[i(" Confirmar exclusão ",-1)])]),_:1}),a(T,null,{default:l(()=>[e[30]||(e[30]=i(" Deseja realmente excluir o produto ",-1)),o("strong",null,n(r.productToDelete?.nome),1),e[31]||(e[31]=i("? Esta ação não poderá ser desfeita. ",-1))]),_:1}),a(q,null,{default:l(()=>[a(I),a(f,{color:"grey",variant:"text",onClick:e[3]||(e[3]=s=>r.deleteDialog=!1)},{default:l(()=>[...e[32]||(e[32]=[i(" Cancelar ",-1)])]),_:1}),a(f,{color:"error",loading:r.deleteLoading,variant:"elevated",onClick:c.deleteProduct},{default:l(()=>[...e[33]||(e[33]=[i(" Excluir ",-1)])]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),a(fe,{modelValue:t.snackbar,"onUpdate:modelValue":e[5]||(e[5]=s=>t.snackbar=s),color:t.snackbarColor,timeout:t.snackbarTimeout,location:"top right"},{default:l(()=>[o("div",Oe,[a(b,{class:"mr-2",icon:t.snackbarColor==="success"?"mdi-check-circle":"mdi-alert-circle"},null,8,["icon"]),i(" "+n(t.snackbarText),1)])]),_:1},8,["modelValue","color","timeout"])]),_:1})}typeof A=="function"&&A(R);const mt=$(R,[["render",Ke],["__scopeId","data-v-7af18342"]]);export{mt as default};
