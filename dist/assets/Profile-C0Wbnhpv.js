import{_,e as E,o as T,a as s,w as o,d as i,b as a,t as p}from"./index-Cgq_6uxJ.js";import{V as b,a as c,b as w,c as f,e as S,d as n,n as x,g as U,h as P,i as V,j as k,f as C,k as I,o as N}from"./VList-EL7smbZR.js";import{a as h,V as y}from"./VTextField-DW8nCNV5.js";import{V as A}from"./VChip-BwqJumVp.js";import{V as z,a as g,b as R,c as v}from"./VTabs-U513DvUr.js";import{V as D}from"./VForm-DePCEDBA.js";import{V as j}from"./VAlert-GDjScSAF.js";import{V as q}from"./VSpacer-BOurC99C.js";import{V as B}from"./VDialog-D0noMbjk.js";import{V as L}from"./VSnackbar-DySBK_uh.js";import"./tag-BQQzLX6E.js";const F={name:"ProfilePage",data(){return{tab:"info",validEdit:!1,validPassword:!1,saving:!1,savingPassword:!1,deleteDialog:!1,snackbar:!1,snackbarText:"",snackbarColor:"success",showCurrentPassword:!1,showNewPassword:!1,showConfirmPassword:!1,userProfile:{id:1,name:"Administrador",email:"admin@sistema.com",role:"Admin",memberSince:"01/01/2024",lastAccess:new Date().toLocaleString("pt-BR"),initials:"AD",avatarColor:"primary"},editData:{name:"",email:""},passwordData:{currentPassword:"",newPassword:"",confirmPassword:""},rules:{required:t=>!!t||"Campo obrigatório",email:t=>/.+@.+\..+/.test(t)||"Email inválido",minLength:t=>t&&t.length>=6||"Mínimo de 6 caracteres",passwordMatch:t=>t===this.passwordData?.newPassword||"As senhas não coincidem"}}},methods:{getInitials(t){const e=t.split(" ");return e.length>=2&&e[0]?.[0]&&e[1]?.[0]?`${e[0][0]}${e[1][0]}`.toUpperCase():t.slice(0,2).toUpperCase()},getRoleColor(t){return{Admin:"error",Gerente:"warning",Operador:"info",Visualizador:"grey"}[t]},getRoleIcon(t){return{Admin:"mdi-shield-crown",Gerente:"mdi-account-tie",Operador:"mdi-account-wrench",Visualizador:"mdi-account-eye"}[t]},async loadUserProfile(){try{const t=await fetch("http://localhost:3001/usuarios");if(!t.ok)throw new Error("Erro ao carregar perfil");const e=await t.json(),u=(Array.isArray(e)&&Array.isArray(e[0])?e[0]:Array.isArray(e)?e:[])[0];if(!u)throw new Error("Usuário não encontrado");this.userProfile={id:u.id,name:u.nome,email:u.email,role:"Admin",memberSince:"01/01/2024",lastAccess:new Date().toLocaleString("pt-BR"),initials:this.getInitials(u.nome),avatarColor:"primary"},this.editData={name:this.userProfile.name,email:this.userProfile.email}}catch(t){console.error("Erro ao carregar perfil:",t),this.snackbarText="Erro ao carregar perfil. Verifique se o backend está rodando.",this.snackbarColor="error",this.snackbar=!0}},cancelEdit(){this.editData={name:this.userProfile.name,email:this.userProfile.email},this.tab="info"},async saveProfile(){this.saving=!0;try{const e=await(await fetch("http://localhost:3001/usuarios")).json(),m=Array.isArray(e)&&Array.isArray(e[0])?e[0]:Array.isArray(e)?e:[],u=m.findIndex(d=>d.id===this.userProfile.id);if(u!==-1){const d=m[u];d&&(m[u]={...d,nome:this.editData.name,email:this.editData.email})}if(!(await fetch("http://localhost:3001/usuarios",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify([m])})).ok)throw new Error("Erro ao atualizar perfil");this.userProfile.name=this.editData.name,this.userProfile.email=this.editData.email,this.userProfile.initials=this.getInitials(this.editData.name),this.snackbarText="Perfil atualizado com sucesso!",this.snackbarColor="success",this.snackbar=!0,this.tab="info"}catch(t){console.error("Erro ao salvar perfil:",t),this.snackbarText="Erro ao atualizar perfil",this.snackbarColor="error",this.snackbar=!0}finally{this.saving=!1}},async changePassword(){this.savingPassword=!0;try{const e=await(await fetch("http://localhost:3001/usuarios")).json(),m=Array.isArray(e)&&Array.isArray(e[0])?e[0]:Array.isArray(e)?e:[],u=m.findIndex(d=>d.id===this.userProfile.id);if(u!==-1){const d=m[u];d&&(m[u]={...d,senha:this.passwordData.newPassword})}if(!(await fetch("http://localhost:3001/usuarios",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify([m])})).ok)throw new Error("Erro ao alterar senha");this.snackbarText="Senha alterada com sucesso!",this.snackbarColor="success",this.snackbar=!0,this.passwordData={currentPassword:"",newPassword:"",confirmPassword:""}}catch(t){console.error("Erro ao alterar senha:",t),this.snackbarText="Erro ao alterar senha",this.snackbarColor="error",this.snackbar=!0}finally{this.savingPassword=!1}},async confirmDeleteAccount(){try{const e=await(await fetch("http://localhost:3001/usuarios")).json(),u=(Array.isArray(e)&&Array.isArray(e[0])?e[0]:Array.isArray(e)?e:[]).filter(d=>d.id!==this.userProfile.id);if(!(await fetch("http://localhost:3001/usuarios",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify([u])})).ok)throw new Error("Erro ao excluir conta");this.snackbarText="Conta excluída com sucesso",this.snackbarColor="success",this.snackbar=!0,setTimeout(()=>{this.$router.push("/login")},2e3)}catch(t){console.error("Erro ao excluir conta:",t),this.snackbarText="Erro ao excluir conta",this.snackbarColor="error",this.snackbar=!0}finally{this.deleteDialog=!1}},goBack(){this.$router.back()}},async mounted(){await this.loadUserProfile()}},O={class:"profile-page"},M={class:"text-h2 text-white font-weight-bold"},J={class:"text-h4 font-weight-bold mb-2"},G={class:"text-h6 text-grey mb-4"},W={class:"text-center"},Z={class:"text-center"},H={class:"text-h5 font-weight-bold mb-6"},K={class:"d-flex align-center mb-2"},Q={class:"text-h6 ml-9"},X={class:"d-flex align-center mb-2"},Y={class:"text-h6 ml-9"},$={class:"d-flex align-center mb-2"},ee={class:"text-h6 ml-9"},se={class:"d-flex align-center mb-2"},oe={class:"ml-9"},re={class:"text-h5 font-weight-bold mb-6"},ae={class:"d-flex justify-end gap-3"},te={class:"text-h5 font-weight-bold mb-6"},le={class:"d-flex justify-end"},ie={class:"text-h6 font-weight-bold mb-4"},ne={class:"d-flex justify-space-between align-center"},de={class:"text-center mb-4"},ue={class:"d-flex align-center"};function ce(t,e,m,u,r,d){return T(),E("div",O,[s(I,{class:"pa-6",fluid:""},{default:o(()=>[s(b,{class:"mb-6"},{default:o(()=>[s(c,{cols:"12"},{default:o(()=>[s(h,{color:"grey-darken-1","prepend-icon":"mdi-arrow-left",variant:"text",onClick:d.goBack},{default:o(()=>[...e[16]||(e[16]=[i(" Voltar ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1}),s(b,null,{default:o(()=>[s(c,{cols:"12",md:"4"},{default:o(()=>[s(w,{class:"profile-card",elevation:"8"},{default:o(()=>[s(f,{class:"text-center pa-8"},{default:o(()=>[s(S,{class:"mb-4",color:r.userProfile.avatarColor,size:"150"},{default:o(()=>[a("span",M,p(r.userProfile.initials),1)]),_:1},8,["color"]),a("h1",J,p(r.userProfile.name),1),a("p",G,p(r.userProfile.email),1),s(A,{class:"mb-4",color:d.getRoleColor(r.userProfile.role),size:"large",variant:"flat"},{default:o(()=>[s(n,{class:"mr-2",icon:d.getRoleIcon(r.userProfile.role)},null,8,["icon"]),i(" "+p(r.userProfile.role),1)]),_:1},8,["color"]),s(x,{class:"my-6"}),s(U,{class:"bg-transparent"},{default:o(()=>[s(P,{class:"px-0"},{prepend:o(()=>[s(n,{color:"success",icon:"mdi-calendar-check"})]),default:o(()=>[s(V,{class:"font-weight-bold"},{default:o(()=>[...e[17]||(e[17]=[i(" Membro desde ",-1)])]),_:1}),s(k,null,{default:o(()=>[i(p(r.userProfile.memberSince),1)]),_:1})]),_:1}),s(P,{class:"px-0"},{prepend:o(()=>[s(n,{color:"info",icon:"mdi-clock-outline"})]),default:o(()=>[s(V,{class:"font-weight-bold"},{default:o(()=>[...e[18]||(e[18]=[i(" Último acesso ",-1)])]),_:1}),s(k,null,{default:o(()=>[i(p(r.userProfile.lastAccess),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(w,{class:"mt-4",elevation:"8"},{default:o(()=>[s(C,{class:"bg-gradient"},{default:o(()=>[s(n,{class:"mr-2",icon:"mdi-chart-box"}),e[19]||(e[19]=i(" Estatísticas ",-1))]),_:1}),s(f,{class:"pa-4"},{default:o(()=>[s(b,null,{default:o(()=>[s(c,{cols:"6"},{default:o(()=>[a("div",W,[s(n,{color:"primary",icon:"mdi-package-variant",size:"40"}),e[20]||(e[20]=a("h3",{class:"text-h4 font-weight-bold mt-2"},"42",-1)),e[21]||(e[21]=a("p",{class:"text-caption text-grey"},"Produtos",-1))])]),_:1}),s(c,{cols:"6"},{default:o(()=>[a("div",Z,[s(n,{color:"success",icon:"mdi-check-circle",size:"40"}),e[22]||(e[22]=a("h3",{class:"text-h4 font-weight-bold mt-2"},"98%",-1)),e[23]||(e[23]=a("p",{class:"text-caption text-grey"},"Taxa de Sucesso",-1))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(c,{cols:"12",md:"8"},{default:o(()=>[s(w,{elevation:"8"},{default:o(()=>[s(z,{modelValue:r.tab,"onUpdate:modelValue":e[0]||(e[0]=l=>r.tab=l),"bg-color":"primary",class:"tabs-header"},{default:o(()=>[s(g,{value:"info"},{default:o(()=>[s(n,{class:"mr-2",icon:"mdi-information"}),e[24]||(e[24]=i(" Informações ",-1))]),_:1}),s(g,{value:"edit"},{default:o(()=>[s(n,{class:"mr-2",icon:"mdi-pencil"}),e[25]||(e[25]=i(" Editar Perfil ",-1))]),_:1}),s(g,{value:"security"},{default:o(()=>[s(n,{class:"mr-2",icon:"mdi-shield-lock"}),e[26]||(e[26]=i(" Segurança ",-1))]),_:1})]),_:1},8,["modelValue"]),s(R,{modelValue:r.tab,"onUpdate:modelValue":e[12]||(e[12]=l=>r.tab=l)},{default:o(()=>[s(v,{value:"info"},{default:o(()=>[s(f,{class:"pa-8"},{default:o(()=>[a("h2",H,[s(n,{class:"mr-2",icon:"mdi-account-details"}),e[27]||(e[27]=i(" Informações Pessoais ",-1))]),s(b,null,{default:o(()=>[s(c,{cols:"12",md:"6"},{default:o(()=>[s(w,{class:"info-card",elevation:"2",variant:"outlined"},{default:o(()=>[s(f,null,{default:o(()=>[a("div",K,[s(n,{class:"mr-3",color:"primary",icon:"mdi-account"}),e[28]||(e[28]=a("span",{class:"text-caption text-grey"},"Nome Completo",-1))]),a("h3",Q,p(r.userProfile.name),1)]),_:1})]),_:1})]),_:1}),s(c,{cols:"12",md:"6"},{default:o(()=>[s(w,{class:"info-card",elevation:"2",variant:"outlined"},{default:o(()=>[s(f,null,{default:o(()=>[a("div",X,[s(n,{class:"mr-3",color:"primary",icon:"mdi-email"}),e[29]||(e[29]=a("span",{class:"text-caption text-grey"},"Email",-1))]),a("h3",Y,p(r.userProfile.email),1)]),_:1})]),_:1})]),_:1}),s(c,{cols:"12",md:"6"},{default:o(()=>[s(w,{class:"info-card",elevation:"2",variant:"outlined"},{default:o(()=>[s(f,null,{default:o(()=>[a("div",$,[s(n,{class:"mr-3",color:"primary",icon:"mdi-shield-account"}),e[30]||(e[30]=a("span",{class:"text-caption text-grey"},"Função",-1))]),a("h3",ee,p(r.userProfile.role),1)]),_:1})]),_:1})]),_:1}),s(c,{cols:"12"},{default:o(()=>[s(w,{class:"info-card",elevation:"2",variant:"outlined"},{default:o(()=>[s(f,null,{default:o(()=>[a("div",se,[s(n,{class:"mr-3",color:"primary",icon:"mdi-information"}),e[31]||(e[31]=a("span",{class:"text-caption text-grey"},"Status da Conta",-1))]),a("div",oe,[s(A,{color:"success",size:"small",variant:"flat"},{default:o(()=>[s(n,{class:"mr-1",icon:"mdi-check-circle",size:"small"}),e[32]||(e[32]=i(" Conta Ativa ",-1))]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(v,{value:"edit"},{default:o(()=>[s(f,{class:"pa-8"},{default:o(()=>[a("h2",re,[s(n,{class:"mr-2",icon:"mdi-pencil"}),e[33]||(e[33]=i(" Editar Perfil ",-1))]),s(D,{ref:"editForm",modelValue:r.validEdit,"onUpdate:modelValue":e[3]||(e[3]=l=>r.validEdit=l)},{default:o(()=>[s(b,null,{default:o(()=>[s(c,{cols:"12",md:"6"},{default:o(()=>[s(y,{modelValue:r.editData.name,"onUpdate:modelValue":e[1]||(e[1]=l=>r.editData.name=l),density:"comfortable","hide-details":"auto",label:"Nome Completo","prepend-inner-icon":"mdi-account",rules:[r.rules.required],variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),s(c,{cols:"12",md:"6"},{default:o(()=>[s(y,{modelValue:r.editData.email,"onUpdate:modelValue":e[2]||(e[2]=l=>r.editData.email=l),density:"comfortable","hide-details":"auto",label:"Email","prepend-inner-icon":"mdi-email",rules:[r.rules.required,r.rules.email],type:"email",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),s(c,{cols:"12"},{default:o(()=>[a("div",ae,[s(h,{color:"grey",variant:"outlined",onClick:d.cancelEdit},{default:o(()=>[...e[34]||(e[34]=[i(" Cancelar ",-1)])]),_:1},8,["onClick"]),s(h,{color:"primary",disabled:!r.validEdit,loading:r.saving,variant:"elevated",onClick:d.saveProfile},{default:o(()=>[s(n,{class:"mr-2",icon:"mdi-content-save"}),e[35]||(e[35]=i(" Salvar Alterações ",-1))]),_:1},8,["disabled","loading","onClick"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(v,{value:"security"},{default:o(()=>[s(f,{class:"pa-8"},{default:o(()=>[a("h2",te,[s(n,{class:"mr-2",icon:"mdi-shield-lock"}),e[36]||(e[36]=i(" Alterar Senha ",-1))]),s(j,{class:"mb-6",color:"info",icon:"mdi-information",variant:"tonal"},{default:o(()=>[...e[37]||(e[37]=[i(" Sua senha deve ter no mínimo 6 caracteres ",-1)])]),_:1}),s(D,{ref:"passwordForm",modelValue:r.validPassword,"onUpdate:modelValue":e[10]||(e[10]=l=>r.validPassword=l)},{default:o(()=>[s(b,null,{default:o(()=>[s(c,{cols:"12"},{default:o(()=>[s(y,{modelValue:r.passwordData.currentPassword,"onUpdate:modelValue":e[4]||(e[4]=l=>r.passwordData.currentPassword=l),"append-inner-icon":r.showCurrentPassword?"mdi-eye":"mdi-eye-off",density:"comfortable","hide-details":"auto",label:"Senha Atual","prepend-inner-icon":"mdi-lock",rules:[r.rules.required],type:r.showCurrentPassword?"text":"password",variant:"outlined","onClick:appendInner":e[5]||(e[5]=l=>r.showCurrentPassword=!r.showCurrentPassword)},null,8,["modelValue","append-inner-icon","rules","type"])]),_:1}),s(c,{cols:"12",md:"6"},{default:o(()=>[s(y,{modelValue:r.passwordData.newPassword,"onUpdate:modelValue":e[6]||(e[6]=l=>r.passwordData.newPassword=l),"append-inner-icon":r.showNewPassword?"mdi-eye":"mdi-eye-off",density:"comfortable","hide-details":"auto",label:"Nova Senha","prepend-inner-icon":"mdi-lock-plus",rules:[r.rules.required,r.rules.minLength],type:r.showNewPassword?"text":"password",variant:"outlined","onClick:appendInner":e[7]||(e[7]=l=>r.showNewPassword=!r.showNewPassword)},null,8,["modelValue","append-inner-icon","rules","type"])]),_:1}),s(c,{cols:"12",md:"6"},{default:o(()=>[s(y,{modelValue:r.passwordData.confirmPassword,"onUpdate:modelValue":e[8]||(e[8]=l=>r.passwordData.confirmPassword=l),"append-inner-icon":r.showConfirmPassword?"mdi-eye":"mdi-eye-off",density:"comfortable","hide-details":"auto",label:"Confirmar Nova Senha","prepend-inner-icon":"mdi-lock-check",rules:[r.rules.required,r.rules.passwordMatch],type:r.showConfirmPassword?"text":"password",variant:"outlined","onClick:appendInner":e[9]||(e[9]=l=>r.showConfirmPassword=!r.showConfirmPassword)},null,8,["modelValue","append-inner-icon","rules","type"])]),_:1}),s(c,{cols:"12"},{default:o(()=>[a("div",le,[s(h,{color:"primary",disabled:!r.validPassword,loading:r.savingPassword,size:"large",variant:"elevated",onClick:d.changePassword},{default:o(()=>[s(n,{class:"mr-2",icon:"mdi-lock-reset"}),e[38]||(e[38]=i(" Alterar Senha ",-1))]),_:1},8,["disabled","loading","onClick"])])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(x,{class:"my-8"}),a("h3",ie,[s(n,{class:"mr-2",color:"error",icon:"mdi-delete-forever"}),e[39]||(e[39]=i(" Zona de Perigo ",-1))]),s(w,{color:"error-lighten-5",variant:"outlined"},{default:o(()=>[s(f,null,{default:o(()=>[a("div",ne,[e[41]||(e[41]=a("div",null,[a("h4",{class:"font-weight-bold mb-1"},"Excluir Conta"),a("p",{class:"text-body-2 text-grey-darken-1"}," Esta ação é permanente e não pode ser desfeita ")],-1)),s(h,{color:"error",variant:"outlined",onClick:e[11]||(e[11]=l=>r.deleteDialog=!0)},{default:o(()=>[s(n,{class:"mr-2",icon:"mdi-delete"}),e[40]||(e[40]=i(" Excluir Conta ",-1))]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),s(B,{modelValue:r.deleteDialog,"onUpdate:modelValue":e[14]||(e[14]=l=>r.deleteDialog=l),"max-width":"500"},{default:o(()=>[s(w,null,{default:o(()=>[s(C,{class:"bg-error pa-4 text-white"},{default:o(()=>[s(n,{class:"mr-2",icon:"mdi-alert-octagon"}),e[42]||(e[42]=i(" Confirmar Exclusão da Conta ",-1))]),_:1}),s(f,{class:"pa-6"},{default:o(()=>[a("div",de,[s(n,{color:"error",icon:"mdi-delete-alert",size:"80"})]),e[43]||(e[43]=a("p",{class:"text-h6 text-center mb-4"}," Tem certeza que deseja excluir sua conta? ",-1)),e[44]||(e[44]=a("p",{class:"text-center text-grey"},[i(" Esta ação é "),a("strong",null,"irreversível"),i(" e todos os seus dados serão permanentemente removidos. ")],-1))]),_:1}),s(N,{class:"pa-4"},{default:o(()=>[s(q),s(h,{variant:"text",onClick:e[13]||(e[13]=l=>r.deleteDialog=!1)},{default:o(()=>[...e[45]||(e[45]=[i(" Cancelar ",-1)])]),_:1}),s(h,{color:"error",variant:"elevated",onClick:d.confirmDeleteAccount},{default:o(()=>[s(n,{class:"mr-2",icon:"mdi-delete"}),e[46]||(e[46]=i(" Sim, Excluir Conta ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(L,{modelValue:r.snackbar,"onUpdate:modelValue":e[15]||(e[15]=l=>r.snackbar=l),color:r.snackbarColor,elevation:"8",location:"top right",timeout:4e3},{default:o(()=>[a("div",ue,[s(n,{class:"mr-2",icon:r.snackbarColor==="success"?"mdi-check-circle":"mdi-alert-circle"},null,8,["icon"]),i(" "+p(r.snackbarText),1)])]),_:1},8,["modelValue","color"])])}const Ve=_(F,[["render",ce],["__scopeId","data-v-3e59ad31"]]);export{Ve as default};
