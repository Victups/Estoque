import{x as Se,u as Ne,i as qe,p as Ue,y as Ee,l as A,z as S,B as Fe,C as Re,D as Ae,E as I,G as Be,n as Oe,H as Qe,a as t,b as i,F as Z,q as j,I as de,J as He,v as ge,K as $,L as je,M as Ge,N as We,_ as Je,f as B,o as p,w as o,e as d,t as u,c as _,h as g}from"./index-2CK1TBd1.js";import{L as Ke}from"./location.service-DKpUiO2x.js";import{L as ue}from"./lote.service-DRwDZ3qN.js";import{M as ce}from"./movement.service-CdOM-luS.js";import{P as Xe}from"./product.service-6MmcmfrT.js";import{s as Ye}from"./snackbar-BTqzwliu.js";import{e as ee}from"./index-BNH3mZEl.js";import{b as me}from"./route-block-B_A1xBdJ.js";import{I as fe,V as x,a as n,d as c,b as h,c as y,e as O,h as te,f as Ze,j as $e}from"./VCard-C0Nnn3PC.js";import{u as et,d as tt,e as ve,f as pe,g as ot,h as at,i as lt,m as it,j as st,k as rt,a as k,V as C,c as N,l as V,n as w,o as D}from"./VTextField-Dl59xlA2.js";import{V as Q}from"./VSelect-BDnerYRz.js";import{V as nt}from"./VDataTable-g9Pk3cLs.js";import{V as dt}from"./VTooltip-D8FHFb_J.js";import{V as H}from"./VChip-ijcJUYKv.js";import{V as ut}from"./VForm-B5T0w2Cq.js";import{V as ct}from"./VAutocomplete-D3vxxXeM.js";import{V as mt}from"./VAlert-B24Zed_l.js";import{V as ft}from"./VSpacer-CVnO6Leu.js";import{V as _e}from"./VDialog-D3PXHU9z.js";import{V as vt}from"./VSnackbar-Dyx3aGnx.js";import"./tag-ClhzHHXz.js";import"./ssrBoot-DL-QNHNL.js";import"./VMenu-CzW1lCu_.js";import"./filter-DzHhRroJ.js";const he={name:"MovimentacaoPage",mixins:[Ye],setup(){return{authStore:Ne()}},data(){return{loading:!1,saving:!1,createDialog:!1,viewDialog:!1,validForm:!1,dialogType:"entrada",search:"",filterType:"Todos",filterDate:"",movements:[],products:[],lotes:[],locations:[],selectedMovement:null,selectedProduct:null,selectedLote:null,formData:{id_produto:null,id_lote:null,quantidade:0,preco_unitario:0,observacao:"",id_localizacao:null,id_localizacao_origem:null,id_localizacao_destino:null},formRef:null,quantidadeInput:"",precoUnitarioInput:"",usarNovoLote:!1,novoLote:{codigo_lote:"",data_validade:""},headers:[{title:"ID",key:"id",width:"80px"},{title:"Tipo",key:"tipo_movimento",width:"120px"},{title:"Produto",key:"produto_nome"},{title:"Lote",key:"lote_codigo"},{title:"Quantidade",key:"quantidade"},{title:"Preço Unit.",key:"preco_unitario"},{title:"Valor Total",key:"valor_total"},{title:"Localização",key:"localizacao"},{title:"Data",key:"data_mov"},{title:"Ações",key:"actions",sortable:!1,width:"100px"}]}},computed:{entradasCount(){return this.movements.filter(a=>a.tipo_movimento==="entrada").length},saidasCount(){return this.movements.filter(a=>a.tipo_movimento==="saida").length},hojeMov(){const a=new Date().toISOString().split("T")[0];return a?this.movements.filter(e=>e.data_mov.startsWith(a)).length:0},filteredMovements(){return this.movements.filter(a=>{const e=this.filterType==="Todos"||this.filterType==="Entrada"&&a.tipo_movimento==="entrada"||this.filterType==="Saída"&&a.tipo_movimento==="saida",f=!this.filterDate||a.data_mov.startsWith(this.filterDate);return e&&f})},valorTotal(){return this.formData.quantidade*(this.formData.preco_unitario||0)},productOptions(){return this.products.map(a=>({label:`${a.codigo} - ${a.nome}`,value:a.id}))},loteOptions(){if(!this.formData.id_produto)return[];const a=this.lotes.filter(l=>l.id_produto===this.formData.id_produto&&l.quantidade>0),e=l=>l?new Date(l).getTime():Number.MAX_SAFE_INTEGER,m=[...a].toSorted((l,r)=>e(l.data_validade)-e(r.data_validade)).map(l=>({label:`${l.codigo_lote} - Val: ${this.formatDate(l.data_validade)} - Qtd: ${l.quantidade}`,value:l.id}));return this.dialogType==="entrada"&&m.unshift({label:"Criar novo lote",value:"novo"}),m},locationOptions(){return this.locations.map(a=>({label:a.localizacao_completa||`${a.corredor} - ${a.prateleira} - ${a.secao}`,value:a.id}))},saidaLocationOptions(){if(this.dialogType!=="saida")return this.locationOptions;if(!this.formData.id_produto)return[];const a=this.lotes.filter(m=>m.id_produto===this.formData.id_produto&&(m.quantidade??0)>0),e=[],f=new Set;for(const m of a){if(!m.id_localizacao||f.has(m.id_localizacao))continue;f.add(m.id_localizacao);const r=this.locations.find(s=>s.id===m.id_localizacao)?.localizacao_completa||this.getLocalizacaoNome(m.id_localizacao)||`Localização ${m.id_localizacao}`;e.push({value:m.id_localizacao,label:r})}return e.length>0?e:this.locationOptions},rules(){return{required:ee.required,positive:ee.positive,numeric:ee.numeric}}},methods:{formatBRLFromCents(a){const e=(a/100).toFixed(2),[f="0",m="00"]=e.split(".");return`${f.replace(/\B(?=(\d{3})+(?!\d))/g,".")},${m}`},toCents(a){const e=a.replace(/[^\d]/g,"");return Number.parseInt(e,10)||0},toNumber(a){const e=a.replace(/[^\d]/g,"");return Number.parseInt(e,10)||0},parseQuantity(a){const e=a.replace(/[^\d]/g,"");return Number.parseInt(e,10)||0},formatQuantity(a){const e=a.replace(/[^\d]/g,"");return e?Number.parseInt(e,10).toLocaleString("pt-BR"):""},onQuantidadeInput(a){const e=this.formatQuantity(a);this.quantidadeInput=e,this.formData.quantidade=this.parseQuantity(a)},onPrecoUnitarioInput(a){const e=this.formatBRLFromCents(this.toCents(a));this.precoUnitarioInput=e,this.formData.preco_unitario=this.toCents(a)/100},formatNumber(a){return a.toLocaleString("pt-BR")},formatCurrency(a){const e=typeof a=="number"?a:0;return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e)},formatDate(a){return a?new Date(a).toLocaleDateString("pt-BR"):"-"},getLocalizacaoNome(a){const e=this.locations.find(f=>f.id===a);return e?e.localizacao_completa||`${e.corredor} - ${e.prateleira} - ${e.secao}`:"Não encontrada"},async loadMovements(){this.loading=!0;try{this.movements=await ce.getAllEnriched()}catch(a){console.error("Erro ao carregar movimentações:",a),this.showError("Erro ao carregar movimentações")}finally{this.loading=!1}},async loadProducts(){try{this.products=await Xe.getAll()}catch(a){console.error("Erro ao carregar produtos:",a)}},async loadLotes(){try{this.lotes=await ue.getAll()}catch(a){console.error("Erro ao carregar lotes:",a)}},async loadLocations(){try{this.locations=await Ke.getAllComplete(this.authStore.ufId)}catch(a){console.error("Erro ao carregar localizações:",a)}},openDialog(a){this.dialogType=a,this.createDialog=!0,this.resetForm()},resetForm(){this.formData={id_produto:null,id_lote:null,quantidade:0,preco_unitario:0,observacao:"",id_localizacao:null,id_localizacao_origem:null,id_localizacao_destino:null},this.quantidadeInput="",this.precoUnitarioInput="",this.selectedProduct=null,this.selectedLote=null,this.usarNovoLote=!1,this.novoLote={codigo_lote:"",data_validade:""}},cancelCreate(){this.createDialog=!1,this.resetForm()},onProductChange(a){if(this.selectedProduct=this.products.find(e=>e.id===a)||null,this.formData.id_lote=null,this.selectedLote=null,this.dialogType==="entrada"){const e=this.lotes.some(f=>f.id_produto===a&&(f.quantidade??0)>0);this.usarNovoLote=!e,this.formData.id_lote=this.usarNovoLote?"novo":null}else this.usarNovoLote=!1},onLoteChange(a){if(a==="novo"){this.usarNovoLote=!0,this.selectedLote=null;return}if(this.usarNovoLote=!1,this.selectedLote=a&&this.lotes.find(e=>e.id===a)||null,this.selectedLote&&this.dialogType==="saida"){const e=this.selectedLote.custo_unitario;e&&(this.precoUnitarioInput=this.formatBRLFromCents(Math.round(e*100)),this.formData.preco_unitario=e)}this.selectedLote&&this.dialogType==="saida"&&(this.formData.id_localizacao_origem=this.selectedLote.id_localizacao??null)},async saveMovement(){if(!this.formData.id_produto){this.showError("Selecione um produto para continuar");return}const a=await this.formRef?.validate?.();if(!(a&&!a.valid)){this.saving=!0;try{const f=Se()?.id??1;let m=typeof this.formData.id_lote=="number"?this.formData.id_lote:null;if(this.dialogType==="entrada"&&(this.usarNovoLote||this.formData.id_lote==="novo"||!m)){if(!this.formData.id_localizacao_destino){this.showError("Informe a localização de destino para criar o lote"),this.saving=!1;return}if(this.formData.quantidade<=0){this.showError("Quantidade deve ser maior que zero"),this.saving=!1;return}const r={id_produto:this.formData.id_produto,codigo_lote:this.novoLote.codigo_lote||void 0,data_validade:this.novoLote.data_validade||void 0,quantidade:this.formData.quantidade,data_entrada:new Date().toISOString().slice(0,10),responsavel_cadastro:f,usuario_log_id:f,id_localizacao:this.formData.id_localizacao_destino??void 0,custo_unitario:this.formData.preco_unitario||void 0,ativo:!0},s=await ue.create(r);m=s.id,this.lotes.push(s),this.formData.id_lote=m,this.usarNovoLote=!1}if(!m){this.showError("Selecione um lote para continuar"),this.saving=!1;return}const l=this.dialogType==="entrada"?this.formData.id_localizacao_destino:this.formData.id_localizacao_origem;await ce.create({id_produto:this.formData.id_produto,id_lote:m,id_usuario:f,quantidade:this.formData.quantidade,tipo_movimento:this.dialogType,preco_unitario:this.formData.preco_unitario||void 0,observacao:this.formData.observacao?.trim()||void 0,id_localizacao:l??null,id_localizacao_origem:this.formData.id_localizacao_origem??null,id_localizacao_destino:this.formData.id_localizacao_destino??null,usuario_log_id:f}),this.showSuccess(`${this.dialogType==="entrada"?"Entrada":"Saída"} registrada com sucesso!`),this.createDialog=!1,this.resetForm(),await this.loadMovements()}catch(e){console.error("Erro ao salvar movimentação:",e),this.showError("Erro ao salvar movimentação")}finally{this.saving=!1}}},viewMovement(a){this.selectedMovement=a,this.viewDialog=!0}},async mounted(){await Promise.all([this.loadMovements(),this.loadProducts(),this.loadLotes(),this.loadLocations()])}},pt=Ue({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:a=>!isNaN(parseFloat(a))},maxRows:{type:[Number,String],validator:a=>!isNaN(parseFloat(a))},suffix:String,modelModifiers:Object,...rt(),...st(),...it()},"VTextarea"),_t=qe()({name:"VTextarea",directives:{vIntersect:fe},inheritAttrs:!1,props:pt(),emits:{"click:control":a=>!0,"mousedown:control":a=>!0,"update:focused":a=>!0,"update:modelValue":a=>!0,"update:rows":a=>!0},setup(a,e){let{attrs:f,emit:m,slots:l}=e;const r=Ee(a,"modelValue"),{isFocused:s,focus:G,blur:oe}=et(a),{onIntersect:ye}=at(a),be=A(()=>typeof a.counterValue=="function"?a.counterValue(r.value):(r.value||"").toString().length),xe=A(()=>{if(f.maxlength)return f.maxlength;if(!(!a.counter||typeof a.counter!="number"&&typeof a.counter!="string"))return a.counter}),ae=S(),q=S(),le=Fe(""),U=S(),E=tt(a),Ve=A(()=>a.persistentPlaceholder||s.value||a.active);function W(){E.isSuppressing.value&&E.update(),U.value!==document.activeElement&&U.value?.focus(),s.value||G()}function we(v){W(),m("click:control",v)}function De(v){m("mousedown:control",v)}function ze(v){v.stopPropagation(),W(),$(()=>{r.value="",We(a["onClick:clear"],v)})}function Le(v){const b=v.target;if(r.value=b.value,a.modelModifiers?.trim){const z=[b.selectionStart,b.selectionEnd];$(()=>{b.selectionStart=z[0],b.selectionEnd=z[1]})}}const T=S(),P=S(Number(a.rows)),J=A(()=>["plain","underlined"].includes(a.variant));Re(()=>{a.autoGrow||(P.value=Number(a.rows))});function M(){a.autoGrow&&$(()=>{if(!T.value||!q.value)return;const v=getComputedStyle(T.value),b=getComputedStyle(q.value.$el),z=parseFloat(v.getPropertyValue("--v-field-padding-top"))+parseFloat(v.getPropertyValue("--v-input-padding-top"))+parseFloat(v.getPropertyValue("--v-field-padding-bottom")),K=T.value.scrollHeight,R=parseFloat(v.lineHeight),X=Math.max(parseFloat(a.rows)*R+z,parseFloat(b.getPropertyValue("--v-input-control-height"))),Y=parseFloat(a.maxRows)*R+z||1/0,L=Ge(K??0,X,Y);P.value=Math.floor((L-z)/R),le.value=je(L)})}Ae(M),I(r,M),I(()=>a.rows,M),I(()=>a.maxRows,M),I(()=>a.density,M),I(P,v=>{m("update:rows",v)});let F;return I(T,v=>{v?(F=new ResizeObserver(M),F.observe(T.value)):F?.disconnect()}),Be(()=>{F?.disconnect()}),Oe(()=>{const v=!!(l.counter||a.counter||a.counterValue),b=!!(v||l.details),[z,K]=Qe(f),{modelValue:R,...X}=ve.filterProps(a),Y={...pe.filterProps(a),"onClick:clear":ze};return t(ve,j({ref:ae,modelValue:r.value,"onUpdate:modelValue":L=>r.value=L,class:["v-textarea v-text-field",{"v-textarea--prefixed":a.prefix,"v-textarea--suffixed":a.suffix,"v-text-field--prefixed":a.prefix,"v-text-field--suffixed":a.suffix,"v-textarea--auto-grow":a.autoGrow,"v-textarea--no-resize":a.noResize||a.autoGrow,"v-input--plain-underlined":J.value},a.class],style:a.style},z,X,{centerAffix:P.value===1&&!J.value,focused:s.value}),{...l,default:L=>{let{id:ke,isDisabled:ie,isDirty:se,isReadonly:Ce,isValid:Te,hasDetails:Me}=L;return t(pe,j({ref:q,style:{"--v-textarea-control-height":le.value},onClick:we,onMousedown:De,"onClick:prependInner":a["onClick:prependInner"],"onClick:appendInner":a["onClick:appendInner"]},Y,{id:ke.value,active:Ve.value||se.value,centerAffix:P.value===1&&!J.value,dirty:se.value||a.dirty,disabled:ie.value,focused:s.value,details:Me.value,error:Te.value===!1}),{...l,default:Ie=>{let{props:{class:re,...ne}}=Ie;return i(Z,null,[a.prefix&&i("span",{class:"v-text-field__prefix"},[a.prefix]),de(i("textarea",j({ref:U,class:re,value:r.value,onInput:Le,autofocus:a.autofocus,readonly:Ce.value,disabled:ie.value,placeholder:a.placeholder,rows:a.rows,name:E.fieldName.value,autocomplete:E.fieldAutocomplete.value,onFocus:W,onBlur:oe},ne,K),null),[[fe,{handler:ye},null,{once:!0}]]),a.autoGrow&&de(i("textarea",{class:ge([re,"v-textarea__sizer"]),id:`${ne.id}-sizer`,"onUpdate:modelValue":Pe=>r.value=Pe,ref:T,readonly:!0,"aria-hidden":"true"},null),[[He,r.value]]),a.suffix&&i("span",{class:"v-text-field__suffix"},[a.suffix])])}})},details:b?L=>i(Z,null,[l.details?.(L),v&&i(Z,null,[i("span",null,null),t(ot,{active:a.persistentCounter||s.value,value:be.value,max:xe.value,disabled:a.disabled},l.counter)])]):void 0})}),lt({},ae,q,U)}}),gt={class:"movimentacao-page"},ht={class:"d-flex justify-space-between align-center mb-4"},yt={class:"text-h3 font-weight-bold mb-2"},bt={class:"d-flex gap-3"},xt={class:"d-flex align-center"},Vt={class:"text-h4 font-weight-bold"},wt={class:"d-flex align-center"},Dt={class:"text-h4 font-weight-bold"},zt={class:"d-flex align-center"},Lt={class:"text-h4 font-weight-bold"},kt={class:"d-flex align-center"},Ct={class:"text-h4 font-weight-bold"},Tt={class:"font-weight-bold"},Mt={class:"font-weight-bold text-primary"},It={key:0},Pt={key:1},St={key:2,class:"text-grey"},Nt={class:"d-flex align-center"},qt={class:"text-h5"},Ut={class:"text-h6 font-weight-bold mb-3"},Et={class:"text-h6 font-weight-bold mb-3"},Ft={class:"text-h6 font-weight-bold mb-3"},Rt={class:"font-weight-bold mb-3 d-flex align-center"},At={class:"font-weight-bold"},Bt={class:"font-weight-bold"},Ot={class:"font-weight-bold"},Qt={class:"font-weight-bold"},Ht={class:"font-weight-bold mb-3 d-flex align-center"},jt={class:"font-weight-bold"},Gt={class:"font-weight-bold text-success"},Wt={class:"font-weight-bold"},Jt={class:"font-weight-bold"},Kt={class:"font-weight-bold d-flex align-center"},Xt={class:"font-weight-bold"},Yt={class:"font-weight-bold"},Zt={class:"font-weight-bold"},$t={class:"font-weight-bold text-primary"},eo={class:"d-flex justify-space-between align-center"},to={class:"d-flex align-center"},oo={class:"text-center mb-4"},ao={class:"d-flex align-center"};function lo(a,e,f,m,l,r){return p(),B("div",gt,[t(Ze,{class:"pa-6",fluid:""},{default:o(()=>[t(x,{class:"mb-6"},{default:o(()=>[t(n,{cols:"12"},{default:o(()=>[i("div",ht,[i("div",null,[i("h1",yt,[t(c,{class:"mr-3",icon:"mdi-swap-horizontal",size:"40"}),e[19]||(e[19]=d(" Movimentação de Estoque ",-1))]),e[20]||(e[20]=i("p",{class:"text-h6 text-grey-darken-1"}," Registre entradas e saídas de produtos ",-1))]),i("div",bt,[t(k,{color:"success",elevation:"2","prepend-icon":"mdi-plus-circle",size:"large",onClick:e[0]||(e[0]=s=>r.openDialog("entrada"))},{default:o(()=>[...e[21]||(e[21]=[d(" Nova Entrada ",-1)])]),_:1}),t(k,{color:"error",elevation:"2","prepend-icon":"mdi-minus-circle",size:"large",onClick:e[1]||(e[1]=s=>r.openDialog("saida"))},{default:o(()=>[...e[22]||(e[22]=[d(" Nova Saída ",-1)])]),_:1})])])]),_:1})]),_:1}),t(x,{class:"mb-6"},{default:o(()=>[t(n,{cols:"12",md:"3",sm:"6"},{default:o(()=>[t(h,{class:"stat-card",elevation:"3"},{default:o(()=>[t(y,null,{default:o(()=>[i("div",xt,[t(O,{class:"mr-4",color:"primary",size:"56"},{default:o(()=>[t(c,{icon:"mdi-swap-horizontal",size:"30"})]),_:1}),i("div",null,[e[23]||(e[23]=i("p",{class:"text-caption text-grey mb-1"},"Total Movimentações",-1)),i("h2",Vt,u(l.movements.length),1)])])]),_:1})]),_:1})]),_:1}),t(n,{cols:"12",md:"3",sm:"6"},{default:o(()=>[t(h,{class:"stat-card",elevation:"3"},{default:o(()=>[t(y,null,{default:o(()=>[i("div",wt,[t(O,{class:"mr-4",color:"success",size:"56"},{default:o(()=>[t(c,{icon:"mdi-arrow-down-circle",size:"30"})]),_:1}),i("div",null,[e[24]||(e[24]=i("p",{class:"text-caption text-grey mb-1"},"Entradas",-1)),i("h2",Dt,u(r.entradasCount),1)])])]),_:1})]),_:1})]),_:1}),t(n,{cols:"12",md:"3",sm:"6"},{default:o(()=>[t(h,{class:"stat-card",elevation:"3"},{default:o(()=>[t(y,null,{default:o(()=>[i("div",zt,[t(O,{class:"mr-4",color:"error",size:"56"},{default:o(()=>[t(c,{icon:"mdi-arrow-up-circle",size:"30"})]),_:1}),i("div",null,[e[25]||(e[25]=i("p",{class:"text-caption text-grey mb-1"},"Saídas",-1)),i("h2",Lt,u(r.saidasCount),1)])])]),_:1})]),_:1})]),_:1}),t(n,{cols:"12",md:"3",sm:"6"},{default:o(()=>[t(h,{class:"stat-card",elevation:"3"},{default:o(()=>[t(y,null,{default:o(()=>[i("div",kt,[t(O,{class:"mr-4",color:"info",size:"56"},{default:o(()=>[t(c,{icon:"mdi-calendar-today",size:"30"})]),_:1}),i("div",null,[e[26]||(e[26]=i("p",{class:"text-caption text-grey mb-1"},"Hoje",-1)),i("h2",Ct,u(r.hojeMov),1)])])]),_:1})]),_:1})]),_:1})]),_:1}),t(x,null,{default:o(()=>[t(n,{cols:"12"},{default:o(()=>[t(h,{class:"main-card",elevation:"3"},{default:o(()=>[t(te,{class:"bg-primary pa-4"},{default:o(()=>[t(c,{class:"mr-2",icon:"mdi-history"}),e[27]||(e[27]=i("span",{class:"text-h5"},"Histórico de Movimentações",-1))]),_:1}),t(y,{class:"pa-6"},{default:o(()=>[t(x,{class:"mb-4"},{default:o(()=>[t(n,{cols:"12",md:"4"},{default:o(()=>[t(C,{modelValue:l.search,"onUpdate:modelValue":e[2]||(e[2]=s=>l.search=s),clearable:"",density:"comfortable","hide-details":"",label:"Buscar",placeholder:"Produto, lote, observação...","prepend-inner-icon":"mdi-magnify",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(n,{cols:"12",md:"3"},{default:o(()=>[t(Q,{modelValue:l.filterType,"onUpdate:modelValue":e[3]||(e[3]=s=>l.filterType=s),clearable:"",density:"comfortable","hide-details":"",items:["Todos","Entrada","Saída"],label:"Tipo","prepend-inner-icon":"mdi-filter",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(n,{cols:"12",md:"3"},{default:o(()=>[t(C,{modelValue:l.filterDate,"onUpdate:modelValue":e[4]||(e[4]=s=>l.filterDate=s),clearable:"",density:"comfortable","hide-details":"",label:"Data","prepend-inner-icon":"mdi-calendar",type:"date",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(n,{class:"d-flex align-center",cols:"12",md:"2"},{default:o(()=>[t(k,{block:"",color:"grey-darken-1","prepend-icon":"mdi-refresh",variant:"outlined",onClick:r.loadMovements},{default:o(()=>[...e[28]||(e[28]=[d(" Atualizar ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1}),t(nt,{class:"elevation-1",headers:l.headers,items:r.filteredMovements,"items-per-page":15,loading:l.loading,"loading-text":"Carregando movimentações...",search:l.search},{"item.tipo_movimento":o(({item:s})=>[t(H,{color:s.tipo_movimento==="entrada"?"success":"error",size:"small",variant:"flat"},{default:o(()=>[t(c,{class:"mr-1",icon:s.tipo_movimento==="entrada"?"mdi-arrow-down":"mdi-arrow-up",size:"small"},null,8,["icon"]),d(" "+u(s.tipo_movimento==="entrada"?"Entrada":"Saída"),1)]),_:2},1032,["color"])]),"item.quantidade":o(({item:s})=>[i("span",Tt,u(r.formatNumber(s.quantidade)),1)]),"item.preco_unitario":o(({item:s})=>[d(u(r.formatCurrency(s.preco_unitario)),1)]),"item.valor_total":o(({item:s})=>[i("span",Mt,u(r.formatCurrency(s.quantidade*s.preco_unitario)),1)]),"item.localizacao":o(({item:s})=>[s.tipo_movimento==="entrada"&&s.localizacao_destino_nome?(p(),B("div",It,[t(H,{color:"success",size:"small",variant:"tonal"},{default:o(()=>[t(c,{class:"mr-1",icon:"mdi-arrow-right",size:"small"}),d(" "+u(s.localizacao_destino_nome),1)]),_:2},1024)])):s.tipo_movimento==="saida"&&s.localizacao_origem_nome?(p(),B("div",Pt,[t(H,{color:"error",size:"small",variant:"tonal"},{default:o(()=>[t(c,{class:"mr-1",icon:"mdi-arrow-left",size:"small"}),d(" "+u(s.localizacao_origem_nome),1)]),_:2},1024)])):(p(),B("span",St,"-"))]),"item.data_mov":o(({item:s})=>[d(u(r.formatDate(s.data_mov)),1)]),"item.actions":o(({item:s})=>[t(dt,{location:"top",text:"Ver detalhes"},{activator:o(({props:G})=>[t(k,j(G,{color:"info",icon:"mdi-eye",size:"small",variant:"tonal",onClick:oe=>r.viewMovement(s)}),null,16,["onClick"])]),_:2},1024)]),_:2},1032,["headers","items","loading","search"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(_e,{modelValue:l.createDialog,"onUpdate:modelValue":e[15]||(e[15]=s=>l.createDialog=s),"max-width":"900",persistent:""},{default:o(()=>[t(h,{elevation:"8"},{default:o(()=>[t(te,{class:ge(["pa-4",l.dialogType==="entrada"?"bg-success":"bg-error"])},{default:o(()=>[i("div",Nt,[t(c,{class:"mr-2",icon:l.dialogType==="entrada"?"mdi-arrow-down-circle":"mdi-arrow-up-circle",size:"30"},null,8,["icon"]),i("span",qt," Nova "+u(l.dialogType==="entrada"?"Entrada":"Saída")+" de Estoque ",1)])]),_:1},8,["class"]),t(y,{class:"pa-6"},{default:o(()=>[t(ut,{ref:"formRef",modelValue:l.validForm,"onUpdate:modelValue":e[14]||(e[14]=s=>l.validForm=s)},{default:o(()=>[t(x,null,{default:o(()=>[t(n,{cols:"12"},{default:o(()=>[i("h3",Ut,[t(c,{class:"mr-2"},{default:o(()=>[...e[29]||(e[29]=[d("mdi-package-variant",-1)])]),_:1}),e[30]||(e[30]=d(" Produto ",-1))])]),_:1}),t(n,{cols:"12",md:"6"},{default:o(()=>[t(ct,{modelValue:l.formData.id_produto,"onUpdate:modelValue":[e[5]||(e[5]=s=>l.formData.id_produto=s),r.onProductChange],clearable:"",density:"comfortable","hide-details":"auto","item-title":"label","item-value":"value",items:r.productOptions,label:"Selecione o Produto","prepend-inner-icon":"mdi-package",rules:[r.rules.required],variant:"outlined"},null,8,["modelValue","items","rules","onUpdate:modelValue"])]),_:1}),t(n,{cols:"12",md:"6"},{default:o(()=>[t(Q,{modelValue:l.formData.id_lote,"onUpdate:modelValue":[e[6]||(e[6]=s=>l.formData.id_lote=s),r.onLoteChange],clearable:"",density:"comfortable",disabled:!l.formData.id_produto,"hide-details":"auto","item-title":"label","item-value":"value",items:r.loteOptions,label:"Lote","prepend-inner-icon":"mdi-barcode",rules:l.dialogType==="saida"?[r.rules.required]:[],variant:"outlined"},null,8,["modelValue","disabled","items","rules","onUpdate:modelValue"])]),_:1}),t(n,{cols:"12"},{default:o(()=>[t(N,{class:"my-4"}),i("h3",Et,[t(c,{class:"mr-2"},{default:o(()=>[...e[31]||(e[31]=[d("mdi-information",-1)])]),_:1}),e[32]||(e[32]=d(" Detalhes da Movimentação ",-1))])]),_:1}),t(n,{cols:"12",md:"4"},{default:o(()=>[t(C,{modelValue:l.quantidadeInput,"onUpdate:modelValue":[e[7]||(e[7]=s=>l.quantidadeInput=s),r.onQuantidadeInput],density:"comfortable","hide-details":"auto",label:"Quantidade","prepend-inner-icon":"mdi-numeric",rules:[r.rules.required,r.rules.positive],variant:"outlined"},null,8,["modelValue","rules","onUpdate:modelValue"])]),_:1}),t(n,{cols:"12",md:"4"},{default:o(()=>[t(C,{modelValue:l.precoUnitarioInput,"onUpdate:modelValue":[e[8]||(e[8]=s=>l.precoUnitarioInput=s),r.onPrecoUnitarioInput],density:"comfortable","hide-details":"auto",label:"Preço Unitário (R$)","prepend-inner-icon":"mdi-currency-usd",rules:[r.rules.required],variant:"outlined"},null,8,["modelValue","rules","onUpdate:modelValue"])]),_:1}),t(n,{cols:"12",md:"4"},{default:o(()=>[t(C,{density:"comfortable","hide-details":"auto",label:"Valor Total (R$)","model-value":r.formatCurrency(r.valorTotal),"prepend-inner-icon":"mdi-calculator",readonly:"",variant:"outlined"},null,8,["model-value"])]),_:1}),t(n,{cols:"12"},{default:o(()=>[t(N,{class:"my-4"}),i("h3",Ft,[t(c,{class:"mr-2"},{default:o(()=>[...e[33]||(e[33]=[d("mdi-map-marker",-1)])]),_:1}),e[34]||(e[34]=d(" Localização ",-1))])]),_:1}),l.dialogType==="saida"?(p(),_(n,{key:0,cols:"12",md:"6"},{default:o(()=>[t(Q,{modelValue:l.formData.id_localizacao_origem,"onUpdate:modelValue":e[9]||(e[9]=s=>l.formData.id_localizacao_origem=s),clearable:"",density:"comfortable","hide-details":"auto","item-title":"label","item-value":"value",items:r.saidaLocationOptions,label:"Origem","prepend-inner-icon":"mdi-source-fork",rules:l.dialogType==="saida"?[r.rules.required]:[],variant:"outlined"},null,8,["modelValue","items","rules"])]),_:1})):g("",!0),l.dialogType==="entrada"?(p(),_(n,{key:1,cols:"12",md:"6"},{default:o(()=>[t(Q,{modelValue:l.formData.id_localizacao_destino,"onUpdate:modelValue":e[10]||(e[10]=s=>l.formData.id_localizacao_destino=s),clearable:"",density:"comfortable","hide-details":"auto","item-title":"label","item-value":"value",items:r.locationOptions,label:"Destino","prepend-inner-icon":"mdi-target",rules:l.dialogType==="entrada"?[r.rules.required]:[],variant:"outlined"},null,8,["modelValue","items","rules"])]),_:1})):g("",!0),l.dialogType==="entrada"&&l.usarNovoLote?(p(),_(n,{key:2,cols:"12"},{default:o(()=>[t(mt,{border:"start",color:"info",density:"comfortable",icon:"mdi-information",variant:"tonal",class:"mb-4"},{default:o(()=>[...e[35]||(e[35]=[d(" Nenhum lote disponível para este produto. Um novo lote será criado utilizando os dados abaixo. ",-1)])]),_:1})]),_:1})):g("",!0),l.dialogType==="entrada"&&l.usarNovoLote?(p(),_(n,{key:3,cols:"12",md:"6"},{default:o(()=>[t(C,{modelValue:l.novoLote.codigo_lote,"onUpdate:modelValue":e[11]||(e[11]=s=>l.novoLote.codigo_lote=s),label:"Código do Lote (opcional)",placeholder:"Gerado automaticamente se vazio","prepend-inner-icon":"mdi-barcode",variant:"outlined"},null,8,["modelValue"])]),_:1})):g("",!0),l.dialogType==="entrada"&&l.usarNovoLote?(p(),_(n,{key:4,cols:"12",md:"6"},{default:o(()=>[t(C,{modelValue:l.novoLote.data_validade,"onUpdate:modelValue":e[12]||(e[12]=s=>l.novoLote.data_validade=s),label:"Data de Validade (opcional)",type:"date","prepend-inner-icon":"mdi-calendar",variant:"outlined"},null,8,["modelValue"])]),_:1})):g("",!0),t(n,{cols:"12"},{default:o(()=>[t(_t,{modelValue:l.formData.observacao,"onUpdate:modelValue":e[13]||(e[13]=s=>l.formData.observacao=s),density:"comfortable","hide-details":"auto",label:"Observações","prepend-inner-icon":"mdi-note-text",rows:"3",variant:"outlined"},null,8,["modelValue"])]),_:1}),l.selectedProduct?(p(),_(n,{key:5,cols:"12"},{default:o(()=>[t(N,{class:"my-4"}),t(h,{class:"info-card",color:"info",variant:"tonal"},{default:o(()=>[t(y,null,{default:o(()=>[i("h4",Rt,[t(c,{class:"mr-2",icon:"mdi-information"}),e[36]||(e[36]=d(" Informações do Produto ",-1))]),t(x,{dense:""},{default:o(()=>[t(n,{cols:"6",md:"3"},{default:o(()=>[e[37]||(e[37]=i("div",{class:"text-caption"},"Código",-1)),i("div",At,u(l.selectedProduct.codigo),1)]),_:1}),t(n,{cols:"6",md:"3"},{default:o(()=>[e[38]||(e[38]=i("div",{class:"text-caption"},"Nome",-1)),i("div",Bt,u(l.selectedProduct.nome),1)]),_:1}),t(n,{cols:"6",md:"3"},{default:o(()=>[e[39]||(e[39]=i("div",{class:"text-caption"},"Estoque Mínimo",-1)),i("div",Ot,u(l.selectedProduct.estoque_minimo),1)]),_:1}),l.selectedProduct&&"estoque_maximo"in l.selectedProduct?(p(),_(n,{key:0,cols:"6",md:"3"},{default:o(()=>[e[40]||(e[40]=i("div",{class:"text-caption"},"Estoque Máximo",-1)),i("div",Qt,u(l.selectedProduct.estoque_maximo),1)]),_:1})):g("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):g("",!0),l.selectedLote?(p(),_(n,{key:6,cols:"12"},{default:o(()=>[t(h,{class:"info-card",color:"success",variant:"tonal"},{default:o(()=>[t(y,null,{default:o(()=>[i("h4",Ht,[t(c,{class:"mr-2",icon:"mdi-package-variant"}),e[41]||(e[41]=d(" Informações do Lote ",-1))]),t(x,{dense:""},{default:o(()=>[t(n,{cols:"6",md:"3"},{default:o(()=>[e[42]||(e[42]=i("div",{class:"text-caption"},"Código Lote",-1)),i("div",jt,u(l.selectedLote.codigo_lote),1)]),_:1}),t(n,{cols:"6",md:"3"},{default:o(()=>[e[43]||(e[43]=i("div",{class:"text-caption"},"Quantidade Disponível",-1)),i("div",Gt,u(l.selectedLote.quantidade),1)]),_:1}),t(n,{cols:"6",md:"3"},{default:o(()=>[e[44]||(e[44]=i("div",{class:"text-caption"},"Validade",-1)),i("div",Wt,u(r.formatDate(l.selectedLote.data_validade)),1)]),_:1}),t(n,{cols:"6",md:"3"},{default:o(()=>[e[45]||(e[45]=i("div",{class:"text-caption"},"Custo Unitário",-1)),i("div",Jt,u(r.formatCurrency(l.selectedLote.custo_unitario??0)),1)]),_:1}),l.selectedLote.id_localizacao?(p(),_(n,{key:0,cols:"12"},{default:o(()=>[e[46]||(e[46]=i("div",{class:"text-caption"},"Localização Atual",-1)),i("div",Kt,[t(c,{class:"mr-2",color:"success",icon:"mdi-map-marker",size:"small"}),d(" "+u(r.getLocalizacaoNome(l.selectedLote.id_localizacao)),1)])]),_:1})):g("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):g("",!0),t(n,{cols:"12"},{default:o(()=>[t(N,{class:"my-4"}),t(h,{color:"grey-lighten-4",variant:"outlined"},{default:o(()=>[t(y,null,{default:o(()=>[e[51]||(e[51]=i("h4",{class:"font-weight-bold mb-3"},"Resumo da Movimentação",-1)),t(x,{dense:""},{default:o(()=>[t(n,{cols:"6",md:"3"},{default:o(()=>[e[47]||(e[47]=i("div",{class:"text-caption text-grey"},"Tipo",-1)),i("div",Xt,u(l.dialogType==="entrada"?"ENTRADA":"SAÍDA"),1)]),_:1}),t(n,{cols:"6",md:"3"},{default:o(()=>[e[48]||(e[48]=i("div",{class:"text-caption text-grey"},"Quantidade",-1)),i("div",Yt,u(l.formData.quantidade||0),1)]),_:1}),t(n,{cols:"6",md:"3"},{default:o(()=>[e[49]||(e[49]=i("div",{class:"text-caption text-grey"},"Preço Unit.",-1)),i("div",Zt,u(r.formatCurrency(l.formData.preco_unitario)),1)]),_:1}),t(n,{cols:"6",md:"3"},{default:o(()=>[e[50]||(e[50]=i("div",{class:"text-caption text-grey"},"Total",-1)),i("div",$t,u(r.formatCurrency(r.valorTotal)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),t($e,{class:"pa-4"},{default:o(()=>[t(ft),t(k,{color:"grey",variant:"text",onClick:r.cancelCreate},{default:o(()=>[t(c,{class:"mr-1",icon:"mdi-close"}),e[52]||(e[52]=d(" Cancelar ",-1))]),_:1},8,["onClick"]),t(k,{color:l.dialogType==="entrada"?"success":"error",disabled:!l.validForm,loading:l.saving,variant:"elevated",onClick:r.saveMovement},{default:o(()=>[t(c,{class:"mr-1",icon:l.dialogType==="entrada"?"mdi-plus-circle":"mdi-minus-circle"},null,8,["icon"]),d(" Registrar "+u(l.dialogType==="entrada"?"Entrada":"Saída"),1)]),_:1},8,["color","disabled","loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(_e,{modelValue:l.viewDialog,"onUpdate:modelValue":e[17]||(e[17]=s=>l.viewDialog=s),"max-width":"700"},{default:o(()=>[l.selectedMovement?(p(),_(h,{key:0,elevation:"8"},{default:o(()=>[t(te,{class:"bg-primary pa-4"},{default:o(()=>[i("div",eo,[i("div",to,[t(c,{class:"mr-2",icon:"mdi-file-document",size:"30"}),e[53]||(e[53]=i("span",{class:"text-h5"},"Detalhes da Movimentação",-1))]),t(k,{icon:"mdi-close",variant:"text",onClick:e[16]||(e[16]=s=>l.viewDialog=!1)})])]),_:1}),t(y,{class:"pa-6"},{default:o(()=>[t(x,null,{default:o(()=>[t(n,{cols:"12"},{default:o(()=>[i("div",oo,[t(H,{color:l.selectedMovement.tipo_movimento==="entrada"?"success":"error",size:"large",variant:"flat"},{default:o(()=>[t(c,{class:"mr-2",icon:l.selectedMovement.tipo_movimento==="entrada"?"mdi-arrow-down":"mdi-arrow-up"},null,8,["icon"]),d(" "+u(l.selectedMovement.tipo_movimento==="entrada"?"ENTRADA":"SAÍDA"),1)]),_:1},8,["color"])])]),_:1}),t(n,{cols:"12",md:"6"},{default:o(()=>[t(V,{class:"px-0"},{prepend:o(()=>[t(c,{color:"primary",icon:"mdi-package"})]),default:o(()=>[t(w,{class:"font-weight-bold"},{default:o(()=>[...e[54]||(e[54]=[d("Produto",-1)])]),_:1}),t(D,null,{default:o(()=>[d(u(l.selectedMovement.produto_nome||`ID: ${l.selectedMovement.id_produto}`),1)]),_:1})]),_:1})]),_:1}),t(n,{cols:"12",md:"6"},{default:o(()=>[t(V,{class:"px-0"},{prepend:o(()=>[t(c,{color:"primary",icon:"mdi-barcode"})]),default:o(()=>[t(w,{class:"font-weight-bold"},{default:o(()=>[...e[55]||(e[55]=[d("Lote",-1)])]),_:1}),t(D,null,{default:o(()=>[d(u(l.selectedMovement.lote_codigo||`ID: ${l.selectedMovement.id_lote}`),1)]),_:1})]),_:1})]),_:1}),l.selectedMovement.tipo_movimento==="entrada"&&l.selectedMovement.localizacao_destino_nome?(p(),_(n,{key:0,cols:"12"},{default:o(()=>[t(V,{class:"px-0"},{prepend:o(()=>[t(c,{color:"success",icon:"mdi-map-marker"})]),default:o(()=>[t(w,{class:"font-weight-bold"},{default:o(()=>[...e[56]||(e[56]=[d("Localização Destino",-1)])]),_:1}),t(D,null,{default:o(()=>[d(u(l.selectedMovement.localizacao_destino_nome),1)]),_:1})]),_:1})]),_:1})):g("",!0),l.selectedMovement.tipo_movimento==="saida"&&l.selectedMovement.localizacao_origem_nome?(p(),_(n,{key:1,cols:"12"},{default:o(()=>[t(V,{class:"px-0"},{prepend:o(()=>[t(c,{color:"error",icon:"mdi-map-marker"})]),default:o(()=>[t(w,{class:"font-weight-bold"},{default:o(()=>[...e[57]||(e[57]=[d("Localização Origem",-1)])]),_:1}),t(D,null,{default:o(()=>[d(u(l.selectedMovement.localizacao_origem_nome),1)]),_:1})]),_:1})]),_:1})):g("",!0),t(n,{cols:"12",md:"6"},{default:o(()=>[t(V,{class:"px-0"},{prepend:o(()=>[t(c,{color:"primary",icon:"mdi-numeric"})]),default:o(()=>[t(w,{class:"font-weight-bold"},{default:o(()=>[...e[58]||(e[58]=[d("Quantidade",-1)])]),_:1}),t(D,null,{default:o(()=>[d(u(r.formatNumber(l.selectedMovement.quantidade)),1)]),_:1})]),_:1})]),_:1}),t(n,{cols:"12",md:"6"},{default:o(()=>[t(V,{class:"px-0"},{prepend:o(()=>[t(c,{color:"primary",icon:"mdi-currency-usd"})]),default:o(()=>[t(w,{class:"font-weight-bold"},{default:o(()=>[...e[59]||(e[59]=[d("Preço Unitário",-1)])]),_:1}),t(D,null,{default:o(()=>[d(u(r.formatCurrency(l.selectedMovement.preco_unitario)),1)]),_:1})]),_:1})]),_:1}),t(n,{cols:"12",md:"6"},{default:o(()=>[t(V,{class:"px-0"},{prepend:o(()=>[t(c,{color:"primary",icon:"mdi-calendar"})]),default:o(()=>[t(w,{class:"font-weight-bold"},{default:o(()=>[...e[60]||(e[60]=[d("Data",-1)])]),_:1}),t(D,null,{default:o(()=>[d(u(r.formatDate(l.selectedMovement.data_mov)),1)]),_:1})]),_:1})]),_:1}),t(n,{cols:"12",md:"6"},{default:o(()=>[t(V,{class:"px-0"},{prepend:o(()=>[t(c,{color:"success",icon:"mdi-calculator"})]),default:o(()=>[t(w,{class:"font-weight-bold"},{default:o(()=>[...e[61]||(e[61]=[d("Valor Total",-1)])]),_:1}),t(D,{class:"text-h6 text-success"},{default:o(()=>[d(u(r.formatCurrency(l.selectedMovement.valor_total??l.selectedMovement.quantidade*(l.selectedMovement.preco_unitario??0))),1)]),_:1})]),_:1})]),_:1}),l.selectedMovement.observacao?(p(),_(n,{key:2,cols:"12"},{default:o(()=>[t(N,{class:"mb-4"}),t(V,{class:"px-0"},{prepend:o(()=>[t(c,{color:"primary",icon:"mdi-note-text"})]),default:o(()=>[t(w,{class:"font-weight-bold"},{default:o(()=>[...e[62]||(e[62]=[d("Observações",-1)])]),_:1}),t(D,null,{default:o(()=>[d(u(l.selectedMovement.observacao),1)]),_:1})]),_:1})]),_:1})):g("",!0)]),_:1})]),_:1})]),_:1})):g("",!0)]),_:1},8,["modelValue"]),t(vt,{modelValue:a.snackbar,"onUpdate:modelValue":e[18]||(e[18]=s=>a.snackbar=s),color:a.snackbarColor,elevation:"8",location:"top right",timeout:a.snackbarTimeout},{default:o(()=>[i("div",ao,[t(c,{class:"mr-2",icon:a.snackbarColor==="success"?"mdi-check-circle":"mdi-alert-circle"},null,8,["icon"]),d(" "+u(a.snackbarText),1)])]),_:1},8,["modelValue","color","timeout"])])}typeof me=="function"&&me(he);const Mo=Je(he,[["render",lo],["__scopeId","data-v-88cb3741"]]);export{Mo as default};
