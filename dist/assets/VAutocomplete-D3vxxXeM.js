import{u as ke,a as Ce,b as xe,c as be,m as Se}from"./VSelect-BDnerYRz.js";import{p as we,q as Fe,V as $,r as Ie,l as H,c as Ae,s as De,i as Pe,t as Re}from"./VTextField-Dl59xlA2.js";import{l as Me,d as W,e as Ee,n as Te,o as Le}from"./VCard-C0Nnn3PC.js";import{u as _e,h as Be,m as Ke}from"./filter-DzHhRroJ.js";import{i as Ne,p as Oe,k as ze,z as P,B as w,y as O,m as Ue,l as V,E as R,K as X,V as qe,n as $e,a as d,b as C,W as He,F as z,q as y,X as We,T as Xe,v as Ye,e as Ze,Y as je,Z as Y,$ as Ge,a0 as Z}from"./index-2CK1TBd1.js";import{V as Je}from"./VMenu-CzW1lCu_.js";import{V as Qe}from"./VChip-ijcJUYKv.js";const el=Oe({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:Boolean,search:String,...Ke({filterKeys:["title"]}),...Se(),...je(Re({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...Le({transition:!1})},"VAutocomplete"),il=Ne()({name:"VAutocomplete",props:el(),emits:{"update:focused":l=>!0,"update:search":l=>!0,"update:modelValue":l=>!0,"update:menu":l=>!0},setup(l,j){let{slots:s}=j;const{t:G}=ze(),m=P(),p=w(!1),g=w(!0),M=w(!1),U=P(),E=P(),o=w(-1),{items:T,transformIn:J,transformOut:Q}=we(l),{textColorClasses:ee,textColorStyles:le}=Me(()=>m.value?.color),c=O(l,"search",""),u=O(l,"modelValue",[],e=>J(e===null?[null]:Ue(e)),e=>{const n=Q(e);return l.multiple?n:n[0]??null}),ae=V(()=>typeof l.counterValue=="function"?l.counterValue(u.value):typeof l.counterValue=="number"?l.counterValue:u.value.length),F=Fe(l),{filteredItems:L,getMatches:te}=_e(l,T,()=>g.value?"":c.value),h=V(()=>l.hideSelected?L.value.filter(e=>!u.value.some(n=>n.value===e.value)):L.value),I=V(()=>!!(l.chips||s.chip)),x=V(()=>I.value||!!s.selection),ue=V(()=>u.value.map(e=>e.props.value)),_=V(()=>(l.autoSelectFirst===!0||l.autoSelectFirst==="exact"&&c.value===h.value[0]?.title)&&h.value.length>0&&!g.value&&!M.value),A=V(()=>l.hideNoData&&!h.value.length||F.isReadonly.value||F.isDisabled.value),B=O(l,"menu"),i=V({get:()=>B.value,set:e=>{B.value&&!e&&U.value?.Î¨openChildren.size||e&&A.value||(B.value=e)}}),{menuId:ne,ariaExpanded:oe,ariaControls:se,ariaLabel:q}=ke(l,i),K=P(),ie=Ce(K,m);function re(e){l.openOnClear&&(i.value=!0),c.value=""}function ce(){A.value||(i.value=!0)}function ve(e){A.value||(p.value&&(e.preventDefault(),e.stopPropagation()),i.value=!i.value)}function de(e){(Y(e)||e.key==="Backspace")&&m.value?.focus()}function fe(e){if(F.isReadonly.value)return;const n=m.value?.selectionStart,r=u.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(e.key)&&e.preventDefault(),["Enter","ArrowDown"].includes(e.key)&&(i.value=!0),["Escape"].includes(e.key)&&(i.value=!1),_.value&&["Enter","Tab"].includes(e.key)&&!u.value.some(t=>{let{value:a}=t;return a===h.value[0].value})&&k(h.value[0]),e.key==="ArrowDown"&&_.value&&K.value?.focus("next"),["Backspace","Delete"].includes(e.key)){if(!l.multiple&&x.value&&u.value.length>0&&!c.value)return k(u.value[0],!1);if(~o.value){e.preventDefault();const t=o.value;k(u.value[o.value],!1),o.value=t>=r-1?r-2:t}else e.key==="Backspace"&&!c.value&&(o.value=r-1);return}if(l.multiple)if(e.key==="ArrowLeft"){if(o.value<0&&n&&n>0)return;const t=o.value>-1?o.value-1:r-1;if(u.value[t])o.value=t;else{const a=c.value?.length??null;o.value=-1,m.value?.setSelectionRange(a,a)}}else if(e.key==="ArrowRight"){if(o.value<0)return;const t=o.value+1;u.value[t]?o.value=t:(o.value=-1,m.value?.setSelectionRange(0,0))}else~o.value&&Y(e)&&(o.value=-1)}function me(e){if(Z(m.value,":autofill")||Z(m.value,":-webkit-autofill")){const n=T.value.find(r=>r.title===e.target.value);n&&k(n)}}function pe(){l.eager&&E.value?.calculateVisibleItems()}function he(){p.value&&(g.value=!0,m.value?.focus())}function ge(e){p.value=!0,setTimeout(()=>{M.value=!0})}function Ve(e){M.value=!1}function ye(e){(e==null||e===""&&!l.multiple&&!x.value)&&(u.value=[])}const N=w(!1);function k(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!e||e.props.disabled))if(l.multiple){const r=u.value.findIndex(a=>(l.valueComparator||Ge)(a.value,e.value)),t=n??!~r;if(~r){const a=t?[...u.value,e]:[...u.value];a.splice(r,1),u.value=a}else t&&(u.value=[...u.value,e]);l.clearOnSelect&&(c.value="")}else{const r=n!==!1;u.value=r?[e]:[],c.value=r&&!x.value?e.title:"",X(()=>{i.value=!1,g.value=!0})}}return R(p,(e,n)=>{e!==n&&(e?(N.value=!0,c.value=l.multiple||x.value?"":String(u.value.at(-1)?.props.title??""),g.value=!0,X(()=>N.value=!1)):(!l.multiple&&c.value==null&&(u.value=[]),i.value=!1,c.value="",o.value=-1))}),R(c,e=>{!p.value||N.value||(e&&(i.value=!0),g.value=!e)}),R(i,()=>{if(!l.hideSelected&&i.value&&u.value.length){const e=h.value.findIndex(n=>u.value.some(r=>n.value===r.value));qe&&window.requestAnimationFrame(()=>{e>=0&&E.value?.scrollToIndex(e)})}}),R(T,(e,n)=>{i.value||p.value&&!n.length&&e.length&&(i.value=!0)}),$e(()=>{const e=!!(!l.hideNoData||h.value.length||s["prepend-item"]||s["append-item"]||s["no-data"]),n=u.value.length>0,r=$.filterProps(l);return d($,y({ref:m},r,{modelValue:c.value,"onUpdate:modelValue":[t=>c.value=t,ye],focused:p.value,"onUpdate:focused":t=>p.value=t,validationValue:u.externalValue,counterValue:ae.value,dirty:n,onChange:me,class:["v-autocomplete",`v-autocomplete--${l.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":i.value,"v-autocomplete--chips":!!l.chips,"v-autocomplete--selection-slot":!!x.value,"v-autocomplete--selecting-index":o.value>-1},l.class],style:l.style,readonly:F.isReadonly.value,placeholder:n?void 0:l.placeholder,"onClick:clear":re,"onMousedown:control":ce,onKeydown:fe,"aria-expanded":oe.value,"aria-controls":se.value}),{...s,default:()=>C(z,null,[d(Je,y({id:ne.value,ref:U,modelValue:i.value,"onUpdate:modelValue":t=>i.value=t,activator:"parent",contentClass:"v-autocomplete__content",disabled:A.value,eager:l.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:l.transition,onAfterEnter:pe,onAfterLeave:he},l.menuProps),{default:()=>[e&&d(Ie,y({ref:K,filterable:!0,selected:ue.value,selectStrategy:l.multiple?"independent":"single-independent",onMousedown:t=>t.preventDefault(),onKeydown:de,onFocusin:ge,onFocusout:Ve,tabindex:"-1",selectable:!0,"aria-live":"polite",color:l.itemColor??l.color},ie,l.listProps),{default:()=>[s["prepend-item"]?.(),!h.value.length&&!l.hideNoData&&(s["no-data"]?.()??d(H,{key:"no-data",title:G(l.noDataText)},null)),d(xe,{ref:E,renderless:!0,items:h.value,itemKey:"value"},{default:t=>{let{item:a,index:v,itemRef:D}=t;const b=y(a.props,{ref:D,key:a.value,active:_.value&&v===0?!0:void 0,onClick:()=>k(a,null)});return a.type==="divider"?s.divider?.({props:a.raw,index:v})??d(Ae,y(a.props,{key:`divider-${v}`}),null):a.type==="subheader"?s.subheader?.({props:a.raw,index:v})??d(De,y(a.props,{key:`subheader-${v}`}),null):s.item?.({item:a,index:v,props:b})??d(H,y(b,{role:"option"}),{prepend:S=>{let{isSelected:f}=S;return C(z,null,[l.multiple&&!l.hideSelected?d(be,{key:a.value,modelValue:f,ripple:!1,tabindex:"-1"},null):void 0,a.props.prependAvatar&&d(Ee,{image:a.props.prependAvatar},null),a.props.prependIcon&&d(W,{icon:a.props.prependIcon},null)])},title:()=>g.value?a.title:Be("v-autocomplete",a.title,te(a)?.title)})}}),s["append-item"]?.()]})]}),u.value.map((t,a)=>{function v(f){f.stopPropagation(),f.preventDefault(),k(t,!1)}const D={"onClick:close":v,onKeydown(f){f.key!=="Enter"&&f.key!==" "||(f.preventDefault(),f.stopPropagation(),v(f))},onMousedown(f){f.preventDefault(),f.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},b=I.value?!!s.chip:!!s.selection,S=b?We(I.value?s.chip({item:t,index:a,props:D}):s.selection({item:t,index:a})):void 0;if(!(b&&!S))return C("div",{key:t.value,class:Ye(["v-autocomplete__selection",a===o.value&&["v-autocomplete__selection--selected",ee.value]]),style:Xe(a===o.value?le.value:{})},[I.value?s.chip?d(Te,{key:"chip-defaults",defaults:{VChip:{closable:l.closableChips,size:"small",text:t.title}}},{default:()=>[S]}):d(Qe,y({key:"chip",closable:l.closableChips,size:"small",text:t.title,disabled:t.props.disabled},D),null):S??C("span",{class:"v-autocomplete__selection-text"},[t.title,l.multiple&&a<u.value.length-1&&C("span",{class:"v-autocomplete__selection-comma"},[Ze(",")])])])})]),"append-inner":function(){for(var t=arguments.length,a=new Array(t),v=0;v<t;v++)a[v]=arguments[v];return C(z,null,[s["append-inner"]?.(...a),l.menuIcon?d(W,{class:"v-autocomplete__menu-icon",color:m.value?.fieldIconColor,icon:l.menuIcon,onMousedown:ve,onClick:He,"aria-label":q.value,title:q.value,tabindex:"-1"},null):void 0])}})}),Pe({isFocused:p,isPristine:g,menu:i,search:c,filteredItems:L,select:k},m)}});export{il as V};
